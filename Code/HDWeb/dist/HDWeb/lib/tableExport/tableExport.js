(function(t){t.fn.extend({tableExport:function(e){var n={consoleLog:false,csvEnclosure:'"',csvSeparator:",",csvUseBOM:true,displayTableName:false,escape:false,excelstyles:["border-bottom","border-top","border-left","border-right"],fileName:"tableExport",htmlContent:false,ignoreColumn:[],ignoreRow:[],jspdf:{orientation:"p",unit:"pt",format:"a4",margins:{left:20,right:10,top:10,bottom:10},autotable:{padding:2,lineHeight:12,fontSize:8,tableExport:{onAfterAutotable:null,onBeforeAutotable:null,onTable:null}}},numbers:{html:{decimalMark:".",thousandsSeparator:","},output:{decimalMark:".",thousandsSeparator:","}},onCellData:null,outputMode:"file",tbodySelector:"tr",theadSelector:"tr",tableName:"myTableName",type:"csv",worksheetName:"xlsWorksheetName"};var o=this;var a=null;var i=0;var s=[];var l="";t.extend(true,n,e);if(n.type=="csv"||n.type=="txt"){var f="";i=0;t(o).find("thead").first().find(n.theadSelector).each(function(){l="";T(this,"th,td",i,function(t,e,r){l+=U(t,e,r)+n.csvSeparator});l=t.trim(l).substring(0,l.length-1);if(l.length>0){if(f.length>0)f+="\n";f+=l}i++});t(o).find("tbody").first().find(n.tbodySelector).each(function(){l="";T(this,"td",i,function(t,e,r){l+=U(t,e,r)+n.csvSeparator});l=t.trim(l).substring(0,l.length-1);if(l.length>0){if(f.length>0)f+="\n";f+=l}i++});f+="\n";if(n.consoleLog===true)console.log(f);if(n.outputMode==="string")return f;if(n.outputMode==="base64")return z(f);try{var u=new Blob([(n.type=="csv"&&n.csvUseBOM?"\ufeff":"")+f],{type:"text/"+(n.type=="csv"?"csv":"plain")+";charset=utf-8"});saveAs(u,n.fileName+"."+n.type)}catch(t){q(n.fileName+"."+n.type,"data:text/"+(n.type=="csv"?"csv":"plain")+";charset=utf-8,"+(n.type=="csv"&&n.csvUseBOM?"\ufeff":"")+encodeURIComponent(f))}}else if(n.type=="sql"){i=0;var d="INSERT INTO `"+n.tableName+"` (";t(o).find("thead").first().find(n.theadSelector).each(function(){T(this,"th,td",i,function(t,e,n){d+="'"+D(t,e,n)+"',"});i++;d=t.trim(d);d=t.trim(d).substring(0,d.length-1)});d+=") VALUES ";t(o).find("tbody").first().find(n.tbodySelector).each(function(){l="";T(this,"td",i,function(t,e,n){l+="'"+D(t,e,n)+"',"});if(l.length>3){d+="("+l;d=t.trim(d).substring(0,d.length-1);d+="),"}i++});d=t.trim(d).substring(0,d.length-1);d+=";";if(n.consoleLog===true)console.log(d);if(n.outputMode=="string")return d;if(n.outputMode=="base64")return z(d);try{var u=new Blob([d],{type:"text/plain;charset=utf-8"});saveAs(u,n.fileName+".sql")}catch(t){q(n.fileName+".sql","data:application/sql;charset=utf-8,"+encodeURIComponent(d))}}else if(n.type=="json"){var p=[];t(o).find("thead").first().find(n.theadSelector).each(function(){var t=[];T(this,"th,td",i,function(e,n,r){t.push(D(e,n,r))});p.push(t)});var h=[];t(o).find("tbody").first().find(n.tbodySelector).each(function(){var t=[];T(this,"td",i,function(e,n,r){t.push(D(e,n,r))});if(t.length>0&&(t.length!=1||t[0]!=""))h.push(t);i++});var m=[];m.push({header:p,data:h});var v=JSON.stringify(m);if(n.consoleLog===true)console.log(v);if(n.outputMode=="string")return v;var g=z(v);if(n.outputMode=="base64")return g;try{var u=new Blob([v],{type:"application/json;charset=utf-8"});saveAs(u,n.fileName+".json")}catch(t){q(n.fileName+".json","data:application/json;charset=utf-8;base64,"+g)}}else if(n.type==="xml"){i=0;var y='<?xml version="1.0" encoding="utf-8"?>';y+="<tabledata><fields>";t(o).find("thead").first().find(n.theadSelector).each(function(){T(this,"th,td",i,function(t,e,n){y+="<field>"+D(t,e,n)+"</field>"});i++});y+="</fields><data>";var b=1;t(o).find("tbody").first().find(n.tbodySelector).each(function(){var t=1;l="";T(this,"td",i,function(e,n,r){l+="<column-"+t+">"+D(e,n,r)+"</column-"+t+">";t++});if(l.length>0&&l!="<column-1></column-1>"){y+='<row id="'+b+'">'+l+"</row>";b++}i++});y+="</data></tabledata>";if(n.consoleLog===true)console.log(y);if(n.outputMode=="string")return y;var g=z(y);if(n.outputMode=="base64")return g;try{var u=new Blob([y],{type:"application/xml;charset=utf-8"});saveAs(u,n.fileName+".xml")}catch(t){q(n.fileName+".xml","data:application/xml;charset=utf-8;base64,"+g)}}else if(n.type=="excel"||n.type=="doc"){i=0;var x="<table>";t(o).find("thead").first().find(n.theadSelector).each(function(){l="";T(this,"th,td",i,function(e,r,o){if(e!=null){l+="<td style='";for(var a in n.excelstyles){if(n.excelstyles.hasOwnProperty(a)){l+=n.excelstyles[a]+": "+t(e).css(n.excelstyles[a])+";"}}l+="'>"+D(e,r,o)+"</td>"}});if(l.length>0)x+="<tr>"+l+"</tr>";i++});t(o).find("tbody").first().find(n.tbodySelector).each(function(){l="";T(this,"td",i,function(e,r,o){if(e!=null){l+="<td style='";for(var a in n.excelstyles){if(n.excelstyles.hasOwnProperty(a)){l+=n.excelstyles[a]+": "+t(e).css(n.excelstyles[a])+";"}}if(t(e).is("[colspan]"))l+="' colspan='"+t(e).attr("colspan");if(t(e).is("[rowspan]"))l+="' rowspan='"+t(e).attr("rowspan");l+="'>"+D(e,r,o)+"</td>"}});if(l.length>0)x+="<tr>"+l+"</tr>";i++});if(n.displayTableName)x+="<tr><td></td></tr><tr><td></td></tr><tr><td>"+D(t("<p>"+n.tableName+"</p>"))+"</td></tr>";x+="</table>";if(n.consoleLog===true)console.log(x);var w="<html xmlns:o='urn:schemas-microsoft-com:office:office' "+"xmlns:x='urn:schemas-microsoft-com:office:"+n.type+"' "+"xmlns='http://www.w3.org/TR/REC-html40'>";w+='<meta http-equiv="content-type" content="application/vnd.ms-'+n.type+'; charset=UTF-8">';w+='<meta http-equiv="content-type" content="application/';w+=n.type==="excel"?"vnd.ms-excel":"msword";w+='; charset=UTF-8">';w+="<head>";if(n.type==="excel"){w+="\x3c!--[if gte mso 9]>";w+="<xml>";w+="<x:ExcelWorkbook>";w+="<x:ExcelWorksheets>";w+="<x:ExcelWorksheet>";w+="<x:Name>";w+=n.worksheetName;w+="</x:Name>";w+="<x:WorksheetOptions>";w+="<x:DisplayGridlines/>";w+="</x:WorksheetOptions>";w+="</x:ExcelWorksheet>";w+="</x:ExcelWorksheets>";w+="</x:ExcelWorkbook>";w+="</xml>";w+="<![endif]--\x3e"}w+="</head>";w+="<body>";w+=x;w+="</body>";w+="</html>";if(n.outputMode=="string")return w;var g=z(w);if(n.outputMode==="base64")return g;var S=n.type==="excel"?"xls":"doc";try{var u=new Blob([w],{type:"application/vnd.ms-"+n.type});saveAs(u,n.fileName+"."+S)}catch(t){q(n.fileName+"."+S,"data:application/vnd.ms-"+n.type+";base64,"+g)}}else if(n.type=="png"){html2canvas(t(o),{onrendered:function(t){var e=t.toDataURL();e=e.substring(22);var r=atob(e);var o=new ArrayBuffer(r.length);var a=new Uint8Array(o);for(var i=0;i<r.length;i++)a[i]=r.charCodeAt(i);try{var s=new Blob([o],{type:"image/png"});saveAs(s,n.fileName+".png")}catch(t){q(n.fileName+".png","data:image/png;base64,"+e)}}})}else if(n.type=="pdf"){if(n.jspdf.autotable===false){var C={dim:{w:P(t(o).first().get(0),"width","mm"),h:P(t(o).first().get(0),"height","mm")},pagesplit:false};var E=new jsPDF(n.jspdf.orientation,n.jspdf.unit,n.jspdf.format);E.addHTML(t(o).first(),n.jspdf.margins.left,n.jspdf.margins.top,C,function(){O(E)})}else{var N=n.jspdf.autotable.tableExport;if(typeof n.jspdf.format==="string"&&n.jspdf.format.toLowerCase()==="bestfit"){var j={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89]};var A="",k="";var M=0;t(o).filter(":visible").each(function(){if(t(this).css("display")!="none"){var e=P(t(this).get(0),"width","pt");if(e>M){if(e>j["a0"][0]){A="a0";k="l"}for(var n in j){if(j.hasOwnProperty(n)){if(j[n][1]>e){A=n;k="l";if(j[n][0]>e)k="p"}}}M=e}}});n.jspdf.format=A==""?"a4":A;n.jspdf.orientation=k==""?"w":k}N.doc=new jsPDF(n.jspdf.orientation,n.jspdf.unit,n.jspdf.format);t(o).filter(":visible").each(function(){if(t(this).css("display")!="none"){var e;var r=0;var o={};N.columns=[];N.rows=[];N.rowoptions={};if(typeof N.onTable==="function")if(N.onTable(t(this),n)===false)return true;Object.keys(n.jspdf.autotable).forEach(function(t){o[t]=n.jspdf.autotable[t]});o.margins={};t.extend(true,o.margins,n.jspdf.margins);if(typeof o.renderCell!=="function"){o.renderCell=function(t,e,n,r,o,a,i,s){var l=s.tableExport.doc;var f=0;l.setFillColor(i%2===0?245:255);l.setTextColor(50);l.rect(t,e,n,r,"F");e+=s.lineHeight/2+l.autoTableTextHeight()/2-2.5;if(typeof s.tableExport.columns[o]!="undefined"){var c=s.tableExport.columns[o];if(typeof c.style!="undefined"){var u=c.style.align;var d=s.tableExport.rowoptions[i+1+":"+o];if(typeof d!="undefined")u=d.style.align;if(u=="right")f=n-l.getStringUnitWidth(""+a)*l.internal.getFontSize()-s.padding;else if(u=="center")f=(n-l.getStringUnitWidth(""+a)*l.internal.getFontSize())/2}}if(f<s.padding)f=s.padding;l.text(a,t+f,e)}}t(this).find("thead").find(n.theadSelector).each(function(){e=0;T(this,"th,td",r,function(t,n,r){var o={title:D(t,n,r),key:e++,style:{align:F(t,"text-align"),bcolor:F(t,"background-color")}};N.columns.push(o)});r++});t(this).find("tbody").find(n.tbodySelector).each(function(){var t=[];var n=0;e=0;T(this,"td",r,function(r,o,a){var i={style:{align:F(r,"text-align"),bcolor:F(r,"background-color")}};N.rowoptions[n+":"+e++]=i;t.push(D(r,o,a))});if(t.length){N.rows.push(t);n++}r++});if(typeof N.onBeforeAutotable==="function")N.onBeforeAutotable(t(this),N.columns,N.rows,o);N.doc.autoTable(N.columns,N.rows,o);if(typeof N.onAfterAutotable==="function")N.onAfterAutotable(t(this),o);n.jspdf.autotable.startY=N.doc.autoTableEndPosY()+o.margins.top}});O(N.doc);N.columns.length=0;N.rows.length=0;delete N.doc;N.doc=null}}function T(e,o,a,i){if(n.ignoreRow.indexOf(a)==-1){t(e).filter(":visible").find(o).each(function(e){if(t(this).data("tableexport-display")=="always"||t(this).css("display")!="none"&&t(this).css("visibility")!="hidden"&&t(this).data("tableexport-display")!="none"){if(n.ignoreColumn.indexOf(e)==-1){if(typeof i==="function"){var o=0;if(typeof s[a]!="undefined"&&s[a].length>0){for(c=0;c<=e;c++){if(typeof s[a][c]!="undefined"){i(null,a,c);delete s[a][c];e++}}}i(this,a,e);if(t(this).is("[colspan]")){o=t(this).attr("colspan");for(c=0;c<o-1;c++)i(null,a,e+c)}if(t(this).is("[rowspan]")){var l=parseInt(t(this).attr("rowspan"));for(r=1;r<l;r++){if(typeof s[a+r]=="undefined")s[a+r]=[];s[a+r][e]="";for(c=1;c<o;c++)s[a+r][e+c]=""}}}}}})}}function O(t){if(n.consoleLog===true)console.log(t.output());if(n.outputMode=="string")return t.output();if(n.outputMode=="base64")return z(t.output());try{var e=t.output("blob");saveAs(e,n.fileName+".pdf")}catch(e){q(n.fileName+".pdf","data:application/pdf;base64,"+z(t.output()))}}function B(t){return t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function L(t,e,n){return t.replace(new RegExp(B(e),"g"),n)}function U(t,e,r){var o="";if(t!=null){var a=D(t,e,r);var i=a===null||a==""?"":a.toString();if(a instanceof Date)o=n.csvEnclosure+a.toLocaleString()+n.csvEnclosure;else{o=L(i,n.csvEnclosure,n.csvEnclosure+n.csvEnclosure);if(o.indexOf(n.csvSeparator)>=0||/[\r\n ]/g.test(o))o=n.csvEnclosure+o+n.csvEnclosure}}return o}function W(t){t=t||"0";t=L(t,n.numbers.html.decimalMark,".");t=L(t,n.numbers.html.thousandsSeparator,"");return typeof t==="number"||jQuery.isNumeric(t)!==false?t:false}function D(e,r,o){var a="";if(e!=null){var i=t(e);if(n.htmlContent===true){a=i.html().trim()}else{a=i.text().trim().replace(/\u00AD/g,"");if(n.numbers.html.decimalMark!=n.numbers.output.decimalMark||n.numbers.html.thousandsSeparator!=n.numbers.output.thousandsSeparator){var s=W(a);if(s!==false){var l=(""+s).split(".");if(l.length==1)l[1]="";var f=l[0].length>3?l[0].length%3:0;a=(s<0?"-":"")+(n.numbers.output.thousandsSeparator?(f?l[0].substr(0,f)+n.numbers.output.thousandsSeparator:"")+l[0].substr(f).replace(/(\d{3})(?=\d)/g,"$1"+n.numbers.output.thousandsSeparator):l[0])+(l[1].length?n.numbers.output.decimalMark+l[1]:"")}}}if(n.escape===true){a=escape(a)}if(typeof n.onCellData==="function"){a=n.onCellData(i,r,o,a)}}return a}function R(t,e,n){return e+"-"+n.toLowerCase()}function F(t,e){try{if(window.getComputedStyle){e=e.replace(/([a-z])([A-Z])/,R);return window.getComputedStyle(t,null).getPropertyValue(e)}if(t.currentStyle){return t.currentStyle[e]}return t.style[e]}catch(t){}return""}function P(t,e,n){var r=100;var o=F(t,e);var a=o.match(/\d+/);if(a!==null){a=a[0];var i=document.createElement("div");i.style.overflow="hidden";i.style.visibility="hidden";t.parentElement.appendChild(i);i.style.width=r+n;var s=r/i.offsetWidth;t.parentElement.removeChild(i);return a*s}return 0}function q(t,e){var n=document.createElement("a");if(n){document.body.appendChild(n);n.style="display: none";n.download=t;n.href=e;if(document.createEvent){if(a==null)a=document.createEvent("MouseEvents");a.initEvent("click",true,false);n.dispatchEvent(a)}else if(document.createEventObject)n.fireEvent("onclick");else if(typeof n.onclick=="function")n.onclick();document.body.removeChild(n)}}function I(t){t=t.replace(/\x0d\x0a/g,"\n");var e="";for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<128){e+=String.fromCharCode(r)}else if(r>127&&r<2048){e+=String.fromCharCode(r>>6|192);e+=String.fromCharCode(r&63|128)}else{e+=String.fromCharCode(r>>12|224);e+=String.fromCharCode(r>>6&63|128);e+=String.fromCharCode(r&63|128)}}return e}function z(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var n="";var r,o,a,i,s,l,f;var c=0;t=I(t);while(c<t.length){r=t.charCodeAt(c++);o=t.charCodeAt(c++);a=t.charCodeAt(c++);i=r>>2;s=(r&3)<<4|o>>4;l=(o&15)<<2|a>>6;f=a&63;if(isNaN(o)){l=f=64}else if(isNaN(a)){f=64}n=n+e.charAt(i)+e.charAt(s)+e.charAt(l)+e.charAt(f)}return n}return this}})})(jQuery);