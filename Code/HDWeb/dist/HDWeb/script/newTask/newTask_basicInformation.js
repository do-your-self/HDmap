layui.link("./script/newTask/newTask_basicInformation.css");layui.define(["layer","element","form","table","config_interactivity","config_constant"],function(a){var e=layui.layer;var i=layui.element;var n=layui.form;var t=layui.table;var s=layui.config_interactivity;var o=layui.config_constant;var l={newTask_basicInformation:function(a){var s=this;var l=null;var r=$("[id^='render-newTask_basicInformation']");r.empty();$.each(r,function(a,s){var l=null;var c=null;var d={};var u="";var f=$("#"+s.id);var k=f.data("componentData");u+='<div class="newTask_basicInformation-contain">';u+='<form class="layui-form" action="">';u+='<div class="newTask_basicInformation-selectGroup newTask_basicInformation-contain_taskNmber">';u+='<label class="newTask_basicInformation-inline-block newTask_basicInformation-title">任务号:</label>';u+='<div class="newTask_basicInformation-inline-block taskNum">';u+='<input onkeydown="if(event.keyCode==32) return false" autocomplete="off" disabled class="layui-input" placeholder="请点击右侧按钮进行选择">';u+="</div>";u+="</div>";u+='<div class="newTask_basicInformation-buttonGroup" id="newTask_basicInformation-addTask">';u+='<div class="layui-btn layui-btn-normal" >添加任务号</div>';u+="</div>";u+='<div class="newTask_basicInformation-buttonGroup" id="newTask_basicInformation-viewTaskAndDelete">';u+='<div class="layui-btn layui-btn-normal">查看子任务并删除</div>';u+="</div>";u+='<div class="newTask_basicInformation-inputGroup">';u+='<label class="newTask_basicInformation-inline-block newTask_basicInformation-title">里程(KM)</label>';u+='<div class="newTask_basicInformation-inline-block theMileage">';u+='<input onkeydown="if(event.keyCode==32) return false" autocomplete="off" class="layui-input" placeholder="请输入里程:">';u+="</div>";u+="</div>";u+='<div class="newTask_basicInformation-selectGroup">';u+='<label class="newTask_basicInformation-inline-block newTask_basicInformation-title">任务类型:</label>';u+='<div class="newTask_basicInformation-inline-block  taskType">';u+="<select>";u+='<option value="">请选择任务类型</option>';$.ajax({type:"get",async:false,url:o.URL_HEADER+"/task/type/search",success:function(a){c=a.data;$.each(a.data,function(a,e){u+='<option title="'+e.id+'">'+e.value+"</option>"})},error:function(a,e){}});u+="</select>";u+="</div>";u+="</div>";u+='<div class="newTask_basicInformation-noteGroup">';u+='<label class="newTask_basicInformation-inline-block newTask_basicInformation-title">备注:</label>';u+='<div class="newTask_basicInformation-inline-block noteData">';u+='<input onkeydown="if(event.keyCode==32) return false" autocomplete="off" class="layui-input newTask_basicInformation-width" placeholder="请输入备注">';u+="</div>";u+="</div>";u+='<div class="newTask_basicInformation-modifyGroup">';u+='<div class="layui-btn layui-btn-normal Modify">修改</div>';u+='<div class="layui-btn layui-btn-normal save">保存</div>';u+="</div>";u+="</form>";u+="</div>";r.empty();r.append(u);i.init();n.render();$(".newTask_basicInformation-modifyGroup .Modify").hide();function m(){var a="";a+='<div class="layui-tab layui-tab-brief newTask_basicInformation_tabs">';a+='<ul class="layui-tab-title">';a+='<li class="layui-this">新增任务号</li>';a+="<li>已有任务号</li>";a+="</ul>";a+='<div class="layui-tab-content">';a+='<div class="layui-tab-item layui-show">';a+='<div class="newTask_basicInformation-container">';a+='<form class="layui-form" action="">';a+='<label class="newTask_basicInformation-Layui-label">输入框</label>';a+='<div class="layui-input-inline newTask_basicInformation-Layui-input">';a+='<input type="text" name="title" required  lay-verify="required" placeholder="搜索任务号" autocomplete="off" class="layui-input addNewTaskSearchValue">';a+="</div>";a+='<div class="layui-btn layui-btn-normal addNewTaskSearch" style="margin-left:16px;">搜索</div>';a+="</form>";a+='<table id="newTask_basicInformation_table_addNewTask" lay-filter="addNewTaskList"></table>';a+="</div>";a+="</div>";a+='<div class="layui-tab-item">';a+='<div class="newTask_basicInformation-container">';a+='<form class="layui-form" action="">';a+='<label class="newTask_basicInformation-Layui-label">输入框</label>';a+='<div class="layui-input-inline newTask_basicInformation-Layui-input">';a+='<input type="text" name="title" required  lay-verify="required" placeholder="搜索任务号" autocomplete="off" class="layui-input addTaskSearchValue">';a+="</div>";a+='<div class="layui-btn layui-btn-normal addTaskSearch" style="margin-left:16px;">搜索</div>';a+="</form>";a+='<table id="newTask_basicInformation_table_addTask" lay-filter="addTaskList"></table>';a+="</div>";a+="</div>";a+="</div>";a+="</div>";a+='<div class="newTask_basicInformation-moveBtn">';a+='<div class="layui-btn layui-btn-primary  closeWindow">取消</div>';a+='<div class="layui-btn layui-btn-normal addMsg">添加</div>';a+="</div>";e.open({title:"添加任务号",type:1,skin:"layui-layer-taskSkin",area:["590px","540px"],content:a,closeBtn:0,shadeClose:true,success:function(){t.render({elem:"#newTask_basicInformation_table_addNewTask",url:o.URL_HEADER+"/taskdata/search_id",page:true,limits:[10,20,30],height:300,cols:[[{field:"id",title:"ID",sort:true,align:"center",event:"addNewTaskList"}]]});t.on("tool(addNewTaskList)",function(a){var e=a.data,i=a.event;if(i==="addNewTaskList"){$.sessionStorage.setItem("newTask_basicInformation_addTaskId_data",JSON.stringify(e))}});$(".addNewTaskSearch").on("click",function(){var a=$(".addNewTaskSearchValue").val();t.reload("newTask_basicInformation_table_addNewTask",{url:o.URL_HEADER+"/taskdata/search_id",where:{search:a},done:function(a,e,i){$.sessionStorage.setItem("newTask_basicInformation_addTaskId_data","null")}})}),t.render({elem:"#newTask_basicInformation_table_addTask",url:o.URL_HEADER+"/task/search_id",page:true,limits:[10,20,30],height:300,cols:[[{field:"task_id",title:"ID",sort:true,align:"center",event:"addTaskId"}]]});t.on("tool(addTaskList)",function(a){var e=a.data,i=a.event;if(i==="addTaskId"){$.sessionStorage.setItem("newTask_basicInformation_addTaskId_data",JSON.stringify(e))}});$(".addTaskSearch").on("click",function(){var a=$(".addTaskSearchValue").val();t.reload("newTask_basicInformation_table_addTask",{url:o.URL_HEADER+"/task/search_id",where:{search:a},done:function(a,e,i){$.sessionStorage.setItem("newTask_basicInformation_addTaskId_data","null")}})}),$(".closeWindow").on("click",function(){e.closeAll();$.sessionStorage.setItem("newTask_basicInformation_addTaskId_data","null")});$(".addMsg").on("click",function(){isClick=true;var a=JSON.parse($.sessionStorage.getItem("newTask_basicInformation_addTaskId_data"));if(a!="null"&&a!=undefined&&a!=null){var i="";$.each(a,function(a,e){i=e});if(isClick==true){var n=$(".newTask_basicInformation-contain_taskNmber input");n.val(i);e.closeAll();$.sessionStorage.setItem("newTask_basicInformation_addTaskId_data","null")}}else{e.alert("请选中要添加的行")}})}})}$("#newTask_basicInformation-addTask").on("click",m);function b(){var a="";a+='<div class="newTask_basicInformation_taskAndDeletecontainer">';a+='<table id="newTask_basicInformation_table_viewTaskAndDelete" lay-filter="viewTaskList"></table>';a+='<div class="newTask_basicInformation-delMoveBtn">';a+='<div class="layui-btn layui-btn-primary closeWindow">取消</div>';a+='<div class="layui-btn layui-btn-normal addMsg">添加</div>';a+='<div class="layui-btn layui-btn-normal reviseMsg">修改</div>';a+="</div>";a+="</div>";var i=$(".newTask_basicInformation-contain_taskNmber input");var n=i.val();if(n.length==0){e.alert("请选择任务号")}else{e.open({title:"查看子任务",type:1,skin:"layui-layer-taskSkin",area:["590px","590px"],content:a,closeBtn:0,shadeClose:true,success:function(){t.render({elem:"#newTask_basicInformation_table_viewTaskAndDelete",url:o.URL_HEADER+"/task/subdata/search",where:{taskId:n},height:450,page:false,cols:[[{field:"subTaskId",title:"编号 ",sort:true,event:"select",align:"center"},{field:"mileage",title:"里程",sort:true,event:"select",align:"center"},{field:"operation",title:"操作",sort:true,event:"select",align:"center",templet:'<div><a class="" href="#" >查看</a>&nbsp;<a class="" lay-event="del">删除</a></div>'}]]});t.on("tool(viewTaskList)",function(a){var i=a.data,s=a.event;if(s==="del"){e.confirm("确定要删除这条数据吗?",function(s){$.ajax({type:"post",url:o.URL_HEADER+"/task/subdata/delete"+"/"+i.id,data:JSON.stringify(),success:function(a){if(a.code==0){e.alert("删除成功");t.reload("newTask_basicInformation_table_viewTaskAndDelete",{url:o.URL_HEADER+"/task/subdata/search",method:"get",where:{taskId:n}})}else{e.alert("删除失败,请重新删除")}},error:function(a){}});a.del();e.close(s)})}if(s==="select"){$.sessionStorage.setItem("newTask_basicInformation_viewTaskAndDelete_data",JSON.stringify(i))}})}});$(".closeWindow").on("click",function(){e.closeAll()});var i=$(".newTask_basicInformation-contain_taskNmber input");var n=i.val();$(".addMsg").on("click",function(){$.sessionStorage.setItem("newTask_basicInformation_viewTaskAndDelete_data",null);var a="";a+='<div class="newTask_basicInformation-moveBtnPosition">';a+='<label class="addinformation-Layui-label">编号:</label>';a+='<div class="layui-input-inline addinformation-Layui-input">';a+='<input onkeydown="if(event.keyCode==32) return false" type="text" name="title" required  lay-verify="required" placeholder="添加编号" autocomplete="off" class="layui-input taskIdData">';a+="</div>";a+="</div>";a+='<div class="newTask_basicInformation-moveBtnPosition">';a+='<label class="addinformation-Layui-label">里程:</label>';a+='<div class="layui-input-inline addinformation-Layui-input">';a+='<input onkeydown="if(event.keyCode==32) return false" type="text" name="title" required  lay-verify="required" placeholder="添加里程" autocomplete="off" class="layui-input mileageData">';a+="</div>";a+="</div>";a+='<div class="newTask_basicInformation-moveBtnPosition">';a+='<div class="layui-btn layui-btn-primary newTask_basicInformation-moveBtn cancelAddTask">取消</div>';a+='<div class="layui-btn layui-btn-normal addMileageokAddTask">确定</div>';a+="</div>";e.open({title:"添加子任务",type:1,skin:"layui-layer-taskSkin",area:["400px","260px"],content:a,closeBtn:0,shadeClose:true,success:function(a,i){$(".addMileageokAddTask").on("click",function(){if($(".mileageData").val()==""){e.alert("里程不能为空")}else if($(".taskIdData").val()==""){e.alert("编号不能为空")}else{var a=Number($(".mileageData").val());var s=Number($(".taskIdData").val());if(isNaN(a)){e.alert("里程应为数字")}else if(isNaN(s)){e.alert("编号应为数字")}else{var l=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",url:o.URL_HEADER+"/task/subdata/save",data:JSON.stringify({taskId:n,subTaskId:s,mileage:a}),success:function(a){if(a.code==0){e.alert("添加成功");e.close(i);e.close(l);t.reload("newTask_basicInformation_table_viewTaskAndDelete",{url:o.URL_HEADER+"/task/subdata/search",method:"get",where:{taskId:n}})}else{e.close(l);e.alert("添加失败")}},error:function(a){e.close(l);e.alert("添加失败")}})}}});$(".cancelAddTask").on("click",function(){e.close(i)})}})});$(".reviseMsg").on("click",function(){var a=JSON.parse($.sessionStorage.getItem("newTask_basicInformation_viewTaskAndDelete_data"));if(a!=null&&a!=undefined&&a!="null"){var i=a.id;var s="";s+='<div class="newTask_basicInformation-moveBtnPosition">';s+='<label class="newTask_basicInformation-Layui-label">里程:</label>';s+='<div class="layui-input-inline newTask_basicInformation-Layui-input">';s+='<input onkeydown="if(event.keyCode==32) return false" type="text" name="title" required  lay-verify="required" placeholder="添加里程" autocomplete="off" class="layui-input mileageData">';s+="</div>";s+='<div class="newTask_basicInformation-moveBtnPosition">';s+='<div class="layui-btn layui-btn-primary newTask_basicInformation-moveBtn cancelAddTask">取消</div>';s+='<div class="layui-btn layui-btn-normal okAddTask">确定</div>';s+="</div>";s+="</div>";e.open({title:"添加子任务",type:1,skin:"layui-layer-taskSkin",area:["400px","180px"],content:s,closeBtn:0,shadeClose:true,success:function(s,l){var r=a.mileage;$(".mileageData").val(r);$(".okAddTask").on("click",function(){if($(".mileageData").val()==""){e.alert("里程不能为空")}else{var a=Number($(".mileageData").val());if(!isNaN(a)){var s=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",url:o.URL_HEADER+"/task/subdata/update",data:JSON.stringify({id:i,mileage:a}),success:function(a){if(a.code==0){e.alert("修改成功");e.close(s);$.sessionStorage.setItem("newTask_basicInformation_viewTaskAndDelete_data",null);t.reload("newTask_basicInformation_table_viewTaskAndDelete",{url:o.URL_HEADER+"/task/subdata/search",method:"get",where:{taskId:n}})}else{e.close(s);e.alert("修改失败")}},error:function(a){e.close(s);e.alert("修改失败")}});e.close(l)}else{e.alert("请输入数字")}}});$(".cancelAddTask").on("click",function(){e.close(l)})}})}else{e.alert("请选择行")}})}}$("#newTask_basicInformation-viewTaskAndDelete").on("click",b);function v(){var a=$(".newTask_basicInformation-selectGroup .taskNum input");var t=$(".newTask_basicInformation-inputGroup .theMileage input");var s=$(".newTask_basicInformation-selectGroup .taskType input");var l=$(".newTask_basicInformation-noteGroup .noteData input");if(a.val()==""){e.alert("任务号不能为空")}else if(t.val()==""){e.alert("里程不能为空")}else if(Number(t.val())==0){e.alert("里程不能为0")}else if(isNaN(Number(t.val()))){e.alert("里程只能为数字")}else if(s.val()==""){e.alert("任务类型不能为空")}else if(l.val()==""){e.alert("备注不能为空")}else{var r=Number(t.val());if(isNaN(r)){e.alert("里程必须为数字")}else{var u={};d.taskId=a.val();u.taskId=a.val();u.typeId=s.val();$.each(c,function(a,e){if(e.value==s.val()){d.typeId=e.id}});d.mileage=r;u.mileage=r;d.des=l.val();u.des=l.val();d.userId=Number($.localStorage.getItem("id"));var f=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",url:o.URL_HEADER+"/task/save",data:JSON.stringify(d),contentType:"application/json",dataType:"json",success:function(a){if(a.code==0){e.alert("基本信息保存成功");e.close(f);$.localStorage.setItem("missionBasicInformation",JSON.stringify(d));$.localStorage.setItem("missionBasicInformationCallData",JSON.stringify(a.data));$(".newTask_basicInformation-selectGroup .taskNum select").attr("disabled",true);$("#newTask_basicInformation-addTask").off("click");$("#newTask_basicInformation-viewTaskAndDelete").off("click");$(".newTask_basicInformation-inputGroup .theMileage input").attr("disabled",true);$(".newTask_basicInformation-selectGroup .taskType select").attr("disabled",true);$(".newTask_basicInformation-noteGroup .noteData input").attr("disabled",true);$(".newTask_basicInformation-modifyGroup .save").off("click");n.render();i.init();$(".newTask_basicInformation-selectGroup .taskNum input").val(d.taskId);$(".newTask_basicInformation-modifyGroup .Modify").show();$(".newTask_basicInformation-modifyGroup .save").css("background","#c2c2c2");$.localStorage.setItem("newTask_basicInformation_pageState",JSON.stringify(u))}else{e.close(f);e.alert("基本信息保存失败")}},error:function(a){e.close(f);e.alert("基本信息保存失败")}})}}}$(".newTask_basicInformation-modifyGroup .save").on("click",v);function _(){$(".newTask_basicInformation-selectGroup .taskNum select").attr("disabled",false);$("#newTask_basicInformation-addTask").off("click");$("#newTask_basicInformation-addTask").on("click",m);$("#newTask_basicInformation-viewTaskAndDelete").off("click");$("#newTask_basicInformation-viewTaskAndDelete").on("click",b);$(".newTask_basicInformation-inputGroup .theMileage input").attr("disabled",false);$(".newTask_basicInformation-selectGroup .taskType select").attr("disabled",false);$(".newTask_basicInformation-noteGroup .noteData input").attr("disabled",false);$(".newTask_basicInformation-modifyGroup .save").off("click");$(".newTask_basicInformation-modifyGroup .save").on("click",v);$(".newTask_basicInformation-modifyGroup .save").css("background","#1E9FFF");n.render();i.init()}$(".newTask_basicInformation-modifyGroup .Modify").on("click",_);var T=JSON.parse($.localStorage.getItem("newTask_basicInformation_pageState"));if(T!=null&&T!=undefined&&T!="null"){$(".newTask_basicInformation-selectGroup .taskNum select").attr("disabled",true);$("#newTask_basicInformation-addTask").off("click");$("#newTask_basicInformation-viewTaskAndDelete").off("click");$(".newTask_basicInformation-inputGroup .theMileage input").attr("disabled",true);$(".newTask_basicInformation-selectGroup .taskType select").attr("disabled",true);$(".newTask_basicInformation-noteGroup .noteData input").attr("disabled",true);$(".newTask_basicInformation-modifyGroup .save").css("background","#c2c2c2");$(".newTask_basicInformation-modifyGroup .save").off("click");$(".newTask_basicInformation-modifyGroup .Modify").show();$(".newTask_basicInformation-modifyGroup .Modify").on("click",_);$(".newTask_basicInformation-contain_taskNmber input").val(T.taskId);$(".newTask_basicInformation-inputGroup .theMileage input").val(T.mileage);$(".newTask_basicInformation-selectGroup .taskType select").val(T.typeId);$(".newTask_basicInformation-noteGroup .noteData input").val(T.des);n.render("select");i.init()}})}};a("newTask_basicInformation",l)});