layui.link("./script/messageStatistics/messageStatistics.css");layui.define(["layer","element","qRouter","table","laydate","form","config_constant"],function(t){var e=layui.layer;var a=layui.element;var i=layui.qRouter;var s=layui.table;var l=layui.form;var n=layui.laydate;var o=layui.config_constant;var c={messageStatistics:function(t){var i=$("[id^='render-messageStatistics']");var c="";c+=' <div class="messageStatistics_contain">';c+='<form action="">';c+='<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">';c+='<ul class="layui-tab-title">';c+='<li class="layui-this">完成情况统计表</li>';c+="<li>工效统计表</li>";c+="<li>月结算表</li>";c+="<li>工时细分表</li>";c+="<li>外包验收质量统计表</li>";c+="<li>结算总表</li>";c+="</ul>";c+='<div class="layui-tab-content">';c+='<div class="layui-tab-item layui-show">';c+='<div class="messageStatistics_position">';c+='<div class="messageStatistics_rigth">';c+='<input type="text" onkeydown="if(event.keyCode==32) return false" name="date" placeholder="请选择开始时间" autocomplete="off" class="layui-input messageStatistics_input messageStatistics_margin" id="stateTime_completionStatisticalTables">';c+='<input type="text" onkeydown="if(event.keyCode==32) return false" name="date" placeholder="请选择结束时间" autocomplete="off" class="layui-input messageStatistics_input messageStatistics_margin" id="endTime_completionStatisticalTables">';c+='<div id="download_operation_completionStatisticalTables" class="messageStatistics_button messageStatistics_margin layui-btn layui-btn-normal">下载</div>';c+='<div id="preview_operation_completionStatisticalTables" class="messageStatistics_button messageStatistics_margin layui-btn layui-btn-normal">预览</div>';c+="</div>";c+="</div>";c+='<table id="messageStatistics_completionStatisticalTables" lay-filter="messageStatistics_completionStatisticalTables"></table>';c+="</div>";c+='<div class="layui-tab-item">';c+='<div class="messageStatistics_position">';c+='<div class="messageStatistics_rigth">';c+='<input type="text" onkeydown="if(event.keyCode==32) return false" name="date" placeholder="请选择开始时间" autocomplete="off" class="layui-input messageStatistics_input messageStatistics_margin" id="stateTime_statisticalTableWorkEffect">';c+='<input type="text" onkeydown="if(event.keyCode==32) return false" name="date" placeholder="请选择结束时间" autocomplete="off" class="layui-input messageStatistics_input messageStatistics_margin" id="endTime_statisticalTableWorkEffect">';c+='<div id="download_operation_statisticalTableWorkEffect" class="messageStatistics_button messageStatistics_margin layui-btn layui-btn-normal">下载</div>';c+='<div id="preview_operation_statisticalTableWorkEffect" class="messageStatistics_button messageStatistics_margin layui-btn layui-btn-normal">预览</div>';c+="</div>";c+="</div>";c+='<table id="messageStatistics_statisticalTableWorkEffect" lay-filter="messageStatistics_statisticalTableWorkEffect"></table>';c+="</div>";c+='<div class="layui-tab-item">';c+='<div class="messageStatistics_position">';c+='<div class="messageStatistics_rigth">';c+='<input type="text" onkeydown="if(event.keyCode==32) return false" name="date" placeholder="请选择开始时间" autocomplete="off" class="layui-input messageStatistics_input messageStatistics_margin" id="stateTime_monthlyStatements">';c+='<input type="text" onkeydown="if(event.keyCode==32) return false" name="date" placeholder="请选择结束时间" autocomplete="off" class="layui-input messageStatistics_input messageStatistics_margin" id="endTime_monthlyStatements">';c+='<div id="download_operation_monthlyStatements" class="messageStatistics_button messageStatistics_margin layui-btn layui-btn-normal">下载</div>';c+='<div id="preview_operation_monthlyStatements" class="messageStatistics_button messageStatistics_margin layui-btn layui-btn-normal">预览</div>';c+="</div>";c+="</div>";c+='<table id="messageStatistics_monthlyStatements" lay-filter="messageStatistics_monthlyStatements"></table>';c+="</div>";c+='<div class="layui-tab-item">';c+='<div class="messageStatistics_position">';c+='<div class="messageStatistics_rigth">';c+='<input type="text" onkeydown="if(event.keyCode==32) return false" name="date" placeholder="请选择开始时间" autocomplete="off" class="layui-input messageStatistics_input messageStatistics_margin" id="stateTime_timeBreakdownTable">';c+='<input type="text" onkeydown="if(event.keyCode==32) return false" name="date" placeholder="请选择结束时间" autocomplete="off" class="layui-input messageStatistics_input messageStatistics_margin" id="endTime_timeBreakdownTable">';c+='<div id="download_operation_timeBreakdownTable" class="messageStatistics_button messageStatistics_margin layui-btn layui-btn-normal">下载</div>';c+='<div id="preview_operation_timeBreakdownTable" class="messageStatistics_button messageStatistics_margin layui-btn layui-btn-normal">预览</div>';c+="</div>";c+="</div>";c+='<table id="messageStatistics_timeBreakdownTable" lay-filter="messageStatistics_timeBreakdownTable"></table>';c+="</div>";c+='<div class="layui-tab-item">';c+='<div class="messageStatistics_position">';c+='<div class="messageStatistics_rigth">';c+='<input type="text" onkeydown="if(event.keyCode==32) return false" name="date" placeholder="请选择开始时间" autocomplete="off" class="layui-input messageStatistics_input messageStatistics_margin" id="stateTime_statisticalTableOutsourcingAcceptanceQuality">';c+='<input type="text" onkeydown="if(event.keyCode==32) return false" name="date" placeholder="请选择结束时间" autocomplete="off" class="layui-input messageStatistics_input messageStatistics_margin" id="endTime_statisticalTableOutsourcingAcceptanceQuality">';c+='<div id="download_operation_statisticalTableOutsourcingAcceptanceQuality" class="messageStatistics_button messageStatistics_margin layui-btn layui-btn-normal">下载</div>';c+='<div id="preview_operation_statisticalTableOutsourcingAcceptanceQuality" class="messageStatistics_button messageStatistics_margin layui-btn layui-btn-normal">预览</div>';c+="</div>";c+="</div>";c+='<table id="messageStatistics_statisticalTableOutsourcingAcceptanceQuality" lay-filter="messageStatistics_statisticalTableOutsourcingAcceptanceQuality"></table>';c+="</div>";c+='<div class="layui-tab-item">';c+='<div class="messageStatistics_position">';c+='<div class="messageStatistics_rigth">';c+='<input type="text" onkeydown="if(event.keyCode==32) return false" name="date" placeholder="请选择开始时间" autocomplete="off" class="layui-input messageStatistics_input messageStatistics_margin" id="stateTime_totalTable">';c+='<input type="text" onkeydown="if(event.keyCode==32) return false" name="date" placeholder="请选择结束时间" autocomplete="off" class="layui-input messageStatistics_input messageStatistics_margin" id="endTime_totalTable">';c+='<div id="download_operation_totalTable" class="messageStatistics_button messageStatistics_margin layui-btn layui-btn-normal">下载</div>';c+='<div id="preview_operation_totalTable" class="messageStatistics_button messageStatistics_margin layui-btn layui-btn-normal">预览</div>';c+="</div>";c+="</div>";c+='<table id="messageStatistics_totalTable" lay-filter="messageStatistics_totalTable"></table>';c+="</div>";c+="</div>";c+="</div> ";c+="</form>";c+="</div>";i.append(c);function r(){function t(){var t=new Date;var e=t.getFullYear();var a=t.getMonth()+1;var i=t.getDate();var s=e+"-"+a+"-"+i;return s}var t=t();function e(t){var e=t.split("-");var a=e[0];var i=e[1];var s=e[2];var l=new Date(a,i,0);l=l.getDate();var n=a;var o=parseInt(i)-1;if(o==0){n=parseInt(n)-1;o=12}var c=s;var r=new Date(n,o,0);r=r.getDate();if(c>r){c=r}if(o<10){o="0"+o}var d=n+"-"+o+"-"+c;return d}var e=e(t);n.render({elem:"#stateTime_completionStatisticalTables",type:"date",value:e});n.render({elem:"#stateTime_statisticalTableWorkEffect",type:"date",value:e});n.render({elem:"#stateTime_monthlyStatements",type:"date",value:e});n.render({elem:"#stateTime_timeBreakdownTable",type:"date",value:e});n.render({elem:"#stateTime_statisticalTableOutsourcingAcceptanceQuality",type:"date",value:e});n.render({elem:"#stateTime_totalTable",type:"date",value:e});n.render({elem:"#endTime_completionStatisticalTables",type:"date",value:t});n.render({elem:"#endTime_statisticalTableWorkEffect",type:"date",value:t});n.render({elem:"#endTime_monthlyStatements",type:"date",value:t});n.render({elem:"#endTime_timeBreakdownTable",type:"date",value:t});n.render({elem:"#endTime_statisticalTableOutsourcingAcceptanceQuality",type:"date",value:t});n.render({elem:"#endTime_totalTable",type:"date",value:t})}function d(){r();var t=$("#stateTime_completionStatisticalTables");var a=$("#endTime_completionStatisticalTables");var i=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",data:JSON.stringify({startEndDate:t.val(),overEndDate:a.val()+" 23:59:59"}),url:o.URL_HEADER+"/task/statistics/search_completion",success:function(t){if(t.code==0||t.code=="0"){e.close(i);var a=t.data[0].head[0];var l=t.data[1].content;var n=[];$.each(a,function(t,e){var a={field:t,title:e,align:"center",minWidth:200};n.push(a)});s.render({elem:"#messageStatistics_completionStatisticalTables",method:"post",page:true,limits:[10,20,30],where:{startDate:null,endDate:null},cols:[n],data:l,done:function(t,e,a){}})}else{e.close(i);e.alert("预览失败请重试")}},error:function(t,a){e.close(i);e.alert("预览失败请重试")}})}d();var u=$("#stateTime_completionStatisticalTables");var m=$("#endTime_completionStatisticalTables");$("#preview_operation_completionStatisticalTables").on("click",function(){if(u.val()==""){e.alert("请选择开始时间")}else if(m.val()==""){e.alert("请选择结束时间")}else{var t=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",data:JSON.stringify({startEndDate:u.val(),overEndDate:m.val()+" 23:59:59"}),url:o.URL_HEADER+"/task/statistics/search_completion",success:function(a){if(a.code==0||a.code=="0"){e.close(t);var i=a.data[1].content;s.reload("messageStatistics_completionStatisticalTables",{data:i})}else{e.close(t);e.alert("预览失败请重试")}},error:function(a,i){e.close(t);e.alert("预览失败请重试")}})}});$("#download_operation_completionStatisticalTables").on("click",function(){if(u.val()==""){e.alert("请选择开始时间")}else if(m.val()==""){e.alert("请选择结束时间")}else{var t=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",data:JSON.stringify({startEndDate:u.val(),overEndDate:m.val()+" 23:59:59"}),contentType:"application/json",url:o.URL_HEADER+"/task/statistics/export_completion",success:function(a){if(a.code==0||a.code=="0"){e.close(t);location.href=a.data}else{e.close(t);e.alert("下载失败请重试")}},error:function(a,i){e.close(t);e.alert("下载失败请重试")}})}});var f=$("#stateTime_statisticalTableWorkEffect");var v=$("#endTime_statisticalTableWorkEffect");$("#preview_operation_statisticalTableWorkEffect").on("click",function(){if(f.val()==""){e.alert("请选择开始时间")}else if(v.val()==""){e.alert("请选择结束时间")}else{var t=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",data:JSON.stringify({startDate:u.val(),overDate:m.val()+" 23:59:59",limit:10,page:1}),url:o.URL_HEADER+"/task/statistics/search_efficiency",success:function(a){if(a.code==0||a.code=="0"){e.close(t);var i=a.data[2].content;s.reload("messageStatistics_statisticalTableWorkEffect",{data:i})}else{e.close(t);e.alert("预览失败请重试")}},error:function(a,i){e.close(t);e.alert("预览失败请重试")}})}});$("#download_operation_statisticalTableWorkEffect").on("click",function(){if(f.val()==""){e.alert("请选择开始时间")}else if(v.val()==""){e.alert("请选择结束时间")}else{var t=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",data:JSON.stringify({startEndDate:u.val(),overEndDate:m.val()+" 23:59:59"}),url:o.URL_HEADER+"/task/statistics/export_efficiency",success:function(a){if(a.code==0||a.code=="0"){e.close(t);location.href=a.data}else{e.close(t);e.alert("下载失败请重试")}},error:function(a,i){e.close(t);e.alert("下载失败请重试")}})}});var p=$("#stateTime_monthlyStatements");var _=$("#endTime_monthlyStatements");$("#preview_operation_monthlyStatements").on("click",function(){if(p.val()==""){e.alert("请选择开始时间")}else if(_.val()==""){}else{var t=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"get",data:{startDate:p.val(),overDate:_.val()+" 23:59:59"},url:o.URL_HEADER+"/task/statistics/export_monthly",success:function(a){if(a.code==0||a.code=="0"){e.close(t)}else{e.close(t);e.alert("预览失败请重试")}},error:function(a,i){e.close(t);e.alert("预览失败请重试")}})}});$("#download_operation_monthlyStatements").on("click",function(){if(p.val()==""){e.alert("请选择开始时间")}else if(_.val()==""){e.alert("请选择结束时间")}else{var t=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",data:JSON.stringify({startEndDate:p.val(),overEndDate:_.val()+" 23:59:59"}),url:o.URL_HEADER+"/task/statistics/export_monthly",success:function(a){if(a.code==0||a.code=="0"){e.close(t);location.href=a.data}else{e.close(t);e.alert("下载失败请重试")}},error:function(a,i){e.close(t);e.alert("下载失败请重试")}})}});var y=$("#stateTime_timeBreakdownTable");var g=$("#endTime_timeBreakdownTable");$("#preview_operation_timeBreakdownTable").on("click",function(){if(y.val()==""){e.alert("请选择开始时间")}else if(g.val()==""){e.alert("请选择结束时间")}else{s.reload("messageStatistics_timeBreakdownTable",{method:"post",url:o.URL_HEADER+"/task/statistics/find",where:{startDate:y.val(),endDate:g.val()+" 23:59:59"}})}});$("#download_operation_timeBreakdownTable").on("click",function(){if(y.val()==""){e.alert("请选择开始时间")}else if(g.val()==""){e.alert("请选择结束时间")}else{var t=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",data:JSON.stringify({startEndDate:y.val(),overEndDate:g.val()+" 23:59:59"}),url:o.URL_HEADER+"/task/statistics/export_workhours",success:function(a){if(a.code==0||a.code=="0"){e.close(t);location.href=a.data}else{e.close(t);e.alert("下载失败请重试")}},error:function(a,i){e.close(t);e.alert("下载失败请重试")}})}});var b=$("#stateTime_statisticalTableOutsourcingAcceptanceQuality");var T=$("#endTime_statisticalTableOutsourcingAcceptanceQuality");$("#preview_operation_statisticalTableOutsourcingAcceptanceQuality").on("click",function(){if(b.val()==""){e.alert("请选择开始时间")}else if(T.val()==""){e.alert("请选择结束时间")}else{var t=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",data:JSON.stringify({startEndDate:b.val(),overEndDate:T.val()+" 23:59:59"}),url:o.URL_HEADER+"/task/statistics/search_out",success:function(a){if(a.code==0||a.code=="0"){e.close(t);var i=a.data[1].content;s.reload("messageStatistics_statisticalTableOutsourcingAcceptanceQuality",{data:i})}else{e.close(t);e.alert("预览失败请重试")}},error:function(a,i){e.close(t);e.alert("预览失败请重试")}})}});$("#download_operation_statisticalTableOutsourcingAcceptanceQuality").on("click",function(){if(b.val()==""){e.alert("请选择开始时间")}else if(T.val()==""){e.alert("请选择结束时间")}else{var t=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",data:JSON.stringify({startEndDate:b.val(),overEndDate:T.val()+" 23:59:59"}),url:o.URL_HEADER+"/task/statistics/export_outsource",success:function(a){if(a.code==0||a.code=="0"){e.close(t);location.href=a.data}else{e.close(t);e.alert("下载失败请重试")}},error:function(a,i){e.close(t);e.alert("下载失败请重试")}})}});var S=$("#stateTime_totalTable");var h=$("#endTime_totalTable");$("#preview_operation_totalTable").on("click",function(){if(S.val()==""){e.alert("请选择开始时间")}else if(h.val()==""){e.alert("请选择结束时间")}else{var t=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"get",data:{startDate:S.val(),overDate:h.val()+" 23:59:59"},url:o.URL_HEADER+"/task/statistics/export_efficiency",success:function(a){if(a.code==0||a.code=="0"){e.close(t)}else{e.close(t);e.alert("预览失败请重试")}},error:function(a,i){e.close(t);e.alert("预览失败请重试")}})}});$("#download_operation_totalTable").on("click",function(){if(S.val()==""){e.alert("请选择开始时间")}else if(h.val()==""){e.alert("请选择结束时间")}else{var t=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",data:JSON.stringify({startEndDate:S.val(),overEndDate:h.val()+" 23:59:59"}),url:o.URL_HEADER+"/task/statistics/export_close",success:function(a){if(a.code==0||a.code=="0"){e.close(t);location.href=a.data}else{e.close(t);e.alert("下载失败请重试")}},error:function(a,i){e.close(t);e.alert("下载失败请重试")}})}});a.on("tab(docDemoTabBrief)",function(t){if(t.index==0){}if(t.index==1){var a=$("#stateTime_statisticalTableWorkEffect");var i=$("#endTime_statisticalTableWorkEffect");var l=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",data:JSON.stringify({startEndDate:a.val(),overEndDate:i.val()+" 23:59:59",limit:10,page:1}),url:o.URL_HEADER+"/task/statistics/search_efficiency",success:function(t){if(t.code==0||t.code=="0"){e.close(l);var a=t.data[1].head[0];var i=t.data[1].top[0];var n=t.data[0].num[0].number;var o=t.data[2].content;var c=[];var r=[];$.each(a,function(t,e){var a={field:t,title:e,align:"center",minWidth:200};c.push(a)});$.each(i,function(t,e){if(t==0){var a={title:e,align:"center",minWidth:200,colspan:2};r.push(a)}else{var a={field:t,title:e,align:"center",minWidth:200,colspan:n};r.push(a)}});s.render({elem:"#messageStatistics_statisticalTableWorkEffect",method:"post",page:true,limits:[10,20,30],where:{startDate:null,endDate:null},cols:[r,c],data:o,done:function(t,e,a){}})}else{e.close(l);e.alert("预览失败请重试")}},error:function(t,a){e.close(l);e.alert("预览失败请重试")}})}if(t.index==2){}if(t.index==3){r();var n=$("#stateTime_timeBreakdownTable");var c=$("#endTime_timeBreakdownTable");s.render({elem:"#messageStatistics_timeBreakdownTable",method:"post",url:o.URL_HEADER+"/task/statistics/find",page:true,limits:[10,20,30],where:{startDate:n.val(),overDate:c.val()+" 23:59:59"},cols:[[{field:"department",title:"单位",sort:true,event:"vehicleNumber",align:"center"},{field:"step_value",title:"作业内容",sort:true,event:"batch_id"},{field:"batch",title:"批次",sort:true,event:"vehicleNumber"},{field:"projects",title:"制作项",sort:true,event:"vehicleNumber"},{field:"accept_number",title:"验收次数",sort:true,event:"vehicleNumber"},{field:"task_id",title:"任务编号",sort:true,event:"vehicleNumber"},{field:"mileage",title:"里程",sort:true,event:"vehicleNumber"},{field:"a_launch_date",title:"开始时间",sort:true,event:"vehicleNumber"},{field:"end_date",title:"结束时间",sort:true,event:"vehicleNumber"},{field:"a_finish_date",title:"完成时间",sort:true,event:"vehicleNumber"},{field:"sum_pre_manday",title:"作业人天",sort:true,event:"vehicleNumber"},{field:"finish_date",title:"结算日期",sort:true,event:"vehicleNumber"},{field:"pre_manday",title:"付款比例",sort:true,event:"vehicleNumber"}]]})}if(t.index==4){var d=$("#stateTime_statisticalTableOutsourcingAcceptanceQuality");var u=$("#endTime_statisticalTableOutsourcingAcceptanceQuality");var l=e.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",data:JSON.stringify({startEndDate:d.val(),overEndDate:u.val()+" 23:59:59"}),url:o.URL_HEADER+"/task/statistics/search_out",success:function(t){if(t.code==0||t.code=="0"){e.close(l);var a=t.data[0].head[0];var i=t.data[0].top[0];var n=null;var o=t.data[1].content;var c=[];$.each(a,function(t,e){var a={field:t,title:e,align:"center",minWidth:200};c.push(a);n=t});s.render({elem:"#messageStatistics_statisticalTableOutsourcingAcceptanceQuality",method:"post",page:true,limits:[10,20,30],where:{startDate:null,endDate:null},cols:[[{field:"username",align:"center",title:i[0],colspan:n}],c],data:o,done:function(t,e,a){}})}else{e.close(l);e.alert("预览失败请重试")}},error:function(t,a){e.close(l);e.alert("预览失败请重试")}})}if(t.index==5){}});a.init();l.render()}};t("messageStatistics",c)});