layui.define(["layer","form"],function(t){"use strict";var e=layui.$,i=layui.layer,a=layui.form,l=layui.hint(),n=layui.device(),o="layedit",r="layui-this",s="layui-show",c="layui-disabled",u=function(){var t=this;t.index=0;t.config={tool:["strong","italic","underline","del","|","left","center","right","|","link","unlink","face","image"],hideTool:[],height:280}};u.prototype.set=function(t){var i=this;e.extend(true,i.config,t);return i};u.prototype.on=function(t,e){return layui.onevent(o,t,e)};u.prototype.build=function(t,i){i=i||{};var a=this,l=a.config,o="layui-layedit",r=e("#"+t),c="LAY_layedit_"+ ++a.index,u=r.next("."+o),y=e.extend({},l,i),f=function(){var t=[],e={};layui.each(y.hideTool,function(t,i){e[i]=true});layui.each(y.tool,function(i,a){if(L[a]&&!e[a]){t.push(L[a])}});return t.join("")}(),m=e(['<div class="'+o+'">','<div class="layui-unselect layui-layedit-tool">'+f+"</div>",'<div class="layui-layedit-iframe">','<iframe id="'+c+'" name="'+c+'" textarea="'+t+'" frameborder="0"></iframe>',"</div>","</div>"].join(""));if(n.ie&&n.ie<8){return r.removeClass("layui-hide").addClass(s)}u[0]&&u.remove();d.call(a,m,r[0],y);r.addClass("layui-hide").after(m);return a.index};u.prototype.getContent=function(t){var e=y(t);if(!e[0])return;return f(e[0].document.body.innerHTML)};u.prototype.getText=function(t){var i=y(t);if(!i[0])return;return e(i[0].document.body).text()};u.prototype.setContent=function(t,i,a){var l=y(t);if(!l[0])return;if(a){e(l[0].document.body).append(i)}else{e(l[0].document.body).html(i)}layedit.sync(t)};u.prototype.sync=function(t){var i=y(t);if(!i[0])return;var a=e("#"+i[1].attr("textarea"));a.val(f(i[0].document.body.innerHTML))};u.prototype.getSelection=function(t){var e=y(t);if(!e[0])return;var i=v(e[0].document);return document.selection?i.text:i.toString()};var d=function(t,i,a){var l=this,n=t.find("iframe");n.css({height:a.height}).on("load",function(){var o=n.contents(),r=n.prop("contentWindow"),s=o.find("head"),c=e(["<style>","*{margin: 0; padding: 0;}","body{padding: 10px; line-height: 20px; overflow-x: hidden; word-wrap: break-word; font: 14px Helvetica Neue,Helvetica,PingFang SC,Microsoft YaHei,Tahoma,Arial,sans-serif; -webkit-box-sizing: border-box !important; -moz-box-sizing: border-box !important; box-sizing: border-box !important;}","a{color:#01AAED; text-decoration:none;}a:hover{color:#c00}","p{margin-bottom: 10px;}","img{display: inline-block; border: none; vertical-align: middle;}","pre{margin: 10px 0; padding: 10px; line-height: 20px; border: 1px solid #ddd; border-left-width: 6px; background-color: #F2F2F2; color: #333; font-family: Courier New; font-size: 12px;}","</style>"].join("")),u=o.find("body");s.append(c);u.attr("contenteditable","true").css({"min-height":a.height}).html(i.value||"");m.apply(l,[r,n,i,a]);x.call(l,r,t,a)})},y=function(t){var i=e("#LAY_layedit_"+t),a=i.prop("contentWindow");return[a,i]},f=function(t){if(n.ie==8){t=t.replace(/<.+>/g,function(t){return t.toLowerCase()})}return t},m=function(t,a,l,o){var r=t.document,s=e(r.body);s.on("keydown",function(t){var e=t.keyCode;if(e===13){var a=v(r);var l=h(a),n=l.parentNode;if(n.tagName.toLowerCase()==="pre"){if(t.shiftKey)return;i.msg("请暂时用shift+enter");return false}r.execCommand("formatBlock",false,"<p>")}});e(l).parents("form").on("submit",function(){var t=s.html();if(n.ie==8){t=t.replace(/<.+>/g,function(t){return t.toLowerCase()})}l.value=t});s.on("paste",function(e){r.execCommand("formatBlock",false,"<p>");setTimeout(function(){p.call(t,s);l.value=s.html()},100)})},p=function(t){var i=this,a=i.document;t.find("*[style]").each(function(){var t=this.style.textAlign;this.removeAttribute("style");e(this).css({"text-align":t||""})});t.find("table").addClass("layui-table");t.find("script,link").remove()},v=function(t){return t.selection?t.selection.createRange():t.getSelection().getRangeAt(0)},h=function(t){return t.endContainer||t.parentElement().childNodes[0]},g=function(t,i,a){var l=this.document,n=document.createElement(t);for(var o in i){n.setAttribute(o,i[o])}n.removeAttribute("text");if(l.selection){var r=a.text||i.text;if(t==="a"&&!r)return;if(r){n.innerHTML=r}a.pasteHTML(e(n).prop("outerHTML"));a.select()}else{var r=a.toString()||i.text;if(t==="a"&&!r)return;if(r){n.innerHTML=r}a.deleteContents();a.insertNode(n)}},b=function(t,i){var a=this.document,l="layedit-tool-active",n=h(v(a)),o=function(e){return t.find(".layedit-tool-"+e)};if(i){i[i.hasClass(l)?"removeClass":"addClass"](l)}t.find(">i").removeClass(l);o("unlink").addClass(c);e(n).parents().each(function(){var t=this.tagName.toLowerCase(),e=this.style.textAlign;if(t==="b"||t==="strong"){o("b").addClass(l)}if(t==="i"||t==="em"){o("i").addClass(l)}if(t==="u"){o("u").addClass(l)}if(t==="strike"){o("d").addClass(l)}if(t==="p"){if(e==="center"){o("center").addClass(l)}else if(e==="right"){o("right").addClass(l)}else{o("left").addClass(l)}}if(t==="a"){o("link").addClass(l);o("unlink").removeClass(c)}})},x=function(t,a,l){var n=t.document,o=e(n.body),r={link:function(i){var a=h(i),l=e(a).parent();k.call(o,{href:l.attr("href"),target:l.attr("target")},function(e){var a=l[0];if(a.tagName==="A"){a.href=e.url}else{g.call(t,"a",{target:e.target,href:e.url,text:e.url},i)}})},unlink:function(t){n.execCommand("unlink")},face:function(e){C.call(this,function(i){g.call(t,"img",{src:i.src,alt:i.alt},e)})},image:function(a){var n=this;layui.use("upload",function(o){var r=l.uploadImage||{};o.render({url:r.url,method:r.type,elem:e(n).find("input")[0],done:function(e){if(e.code==0){e.data=e.data||{};g.call(t,"img",{src:e.data.src,alt:e.data.title},a)}else{i.msg(e.msg||"上传失败")}}})})},code:function(e){w.call(o,function(i){g.call(t,"pre",{text:i.code,"lay-lang":i.lang},e)})},help:function(){i.open({type:2,title:"帮助",area:["600px","380px"],shadeClose:true,shade:.1,skin:"layui-layer-msg",content:["http://www.layui.com/about/layedit/help.html","no"]})}},s=a.find(".layui-layedit-tool"),u=function(){var i=e(this),a=i.attr("layedit-event"),l=i.attr("lay-command");if(i.hasClass(c))return;o.focus();var u=v(n),d=u.commonAncestorContainer;if(l){n.execCommand(l);if(/justifyLeft|justifyCenter|justifyRight/.test(l)){n.execCommand("formatBlock",false,"<p>")}setTimeout(function(){o.focus()},10)}else{r[a]&&r[a].call(this,u)}b.call(t,s,i)},d=/image/;s.find(">i").on("mousedown",function(){var t=e(this),i=t.attr("layedit-event");if(d.test(i))return;u.call(this)}).on("click",function(){var t=e(this),i=t.attr("layedit-event");if(!d.test(i))return;u.call(this)});o.on("click",function(){b.call(t,s);i.close(C.index)})},k=function(t,e){var l=this,n=i.open({type:1,id:"LAY_layedit_link",area:"350px",shade:.05,shadeClose:true,moveType:1,title:"超链接",skin:"layui-layer-msg",content:['<ul class="layui-form" style="margin: 15px;">','<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">URL</label>','<div class="layui-input-block" style="margin-left: 90px">','<input name="url" lay-verify="url" value="'+(t.href||"")+'" autofocus="true" autocomplete="off" class="layui-input">',"</div>","</li>",'<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">打开方式</label>','<div class="layui-input-block" style="margin-left: 90px">','<input type="radio" name="target" value="_self" class="layui-input" title="当前窗口"'+(t.target==="_self"||!t.target?"checked":"")+">",'<input type="radio" name="target" value="_blank" class="layui-input" title="新窗口" '+(t.target==="_blank"?"checked":"")+">","</div>","</li>",'<li class="layui-form-item" style="text-align: center;">','<button type="button" lay-submit lay-filter="layedit-link-yes" class="layui-btn"> 确定 </button>','<button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> 取消 </button>',"</li>","</ul>"].join(""),success:function(t,n){var o="submit(layedit-link-yes)";a.render("radio");t.find(".layui-btn-primary").on("click",function(){i.close(n);l.focus()});a.on(o,function(t){i.close(k.index);e&&e(t.field)})}});k.index=n},C=function(t){var a=function(){var t=["[微笑]","[嘻嘻]","[哈哈]","[可爱]","[可怜]","[挖鼻]","[吃惊]","[害羞]","[挤眼]","[闭嘴]","[鄙视]","[爱你]","[泪]","[偷笑]","[亲亲]","[生病]","[太开心]","[白眼]","[右哼哼]","[左哼哼]","[嘘]","[衰]","[委屈]","[吐]","[哈欠]","[抱抱]","[怒]","[疑问]","[馋嘴]","[拜拜]","[思考]","[汗]","[困]","[睡]","[钱]","[失望]","[酷]","[色]","[哼]","[鼓掌]","[晕]","[悲伤]","[抓狂]","[黑线]","[阴险]","[怒骂]","[互粉]","[心]","[伤心]","[猪头]","[熊猫]","[兔子]","[ok]","[耶]","[good]","[NO]","[赞]","[来]","[弱]","[草泥马]","[神马]","[囧]","[浮云]","[给力]","[围观]","[威武]","[奥特曼]","[礼物]","[钟]","[话筒]","[蜡烛]","[蛋糕]"],e={};layui.each(t,function(t,i){e[i]=layui.cache.dir+"images/face/"+t+".gif"});return e}();C.hide=C.hide||function(t){if(e(t.target).attr("layedit-event")!=="face"){i.close(C.index)}};return C.index=i.tips(function(){var t=[];layui.each(a,function(e,i){t.push('<li title="'+e+'"><img src="'+i+'" alt="'+e+'"></li>')});return'<ul class="layui-clear">'+t.join("")+"</ul>"}(),this,{tips:1,time:0,skin:"layui-box layui-util-face",maxWidth:500,success:function(l,n){l.css({marginTop:-4,marginLeft:-10}).find(".layui-clear>li").on("click",function(){t&&t({src:a[this.title],alt:this.title});i.close(n)});e(document).off("click",C.hide).on("click",C.hide)}})},w=function(t){var e=this,l=i.open({type:1,id:"LAY_layedit_code",area:"550px",shade:.05,shadeClose:true,moveType:1,title:"插入代码",skin:"layui-layer-msg",content:['<ul class="layui-form layui-form-pane" style="margin: 15px;">','<li class="layui-form-item">','<label class="layui-form-label">请选择语言</label>','<div class="layui-input-block">','<select name="lang">','<option value="JavaScript">JavaScript</option>','<option value="HTML">HTML</option>','<option value="CSS">CSS</option>','<option value="Java">Java</option>','<option value="PHP">PHP</option>','<option value="C#">C#</option>','<option value="Python">Python</option>','<option value="Ruby">Ruby</option>','<option value="Go">Go</option>',"</select>","</div>","</li>",'<li class="layui-form-item layui-form-text">','<label class="layui-form-label">代码</label>','<div class="layui-input-block">','<textarea name="code" lay-verify="required" autofocus="true" class="layui-textarea" style="height: 200px;"></textarea>',"</div>","</li>",'<li class="layui-form-item" style="text-align: center;">','<button type="button" lay-submit lay-filter="layedit-code-yes" class="layui-btn"> 确定 </button>','<button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> 取消 </button>',"</li>","</ul>"].join(""),success:function(l,n){var o="submit(layedit-code-yes)";a.render("select");l.find(".layui-btn-primary").on("click",function(){i.close(n);e.focus()});a.on(o,function(e){i.close(w.index);t&&t(e.field)})}});w.index=l},L={html:'<i class="layui-icon layedit-tool-html" title="HTML源代码" lay-command="html" layedit-event="html"">&#xe64b;</i><span class="layedit-tool-mid"></span>',strong:'<i class="layui-icon layedit-tool-b" title="加粗" lay-command="Bold" layedit-event="b"">&#xe62b;</i>',italic:'<i class="layui-icon layedit-tool-i" title="斜体" lay-command="italic" layedit-event="i"">&#xe644;</i>',underline:'<i class="layui-icon layedit-tool-u" title="下划线" lay-command="underline" layedit-event="u"">&#xe646;</i>',del:'<i class="layui-icon layedit-tool-d" title="删除线" lay-command="strikeThrough" layedit-event="d"">&#xe64f;</i>',"|":'<span class="layedit-tool-mid"></span>',left:'<i class="layui-icon layedit-tool-left" title="左对齐" lay-command="justifyLeft" layedit-event="left"">&#xe649;</i>',center:'<i class="layui-icon layedit-tool-center" title="居中对齐" lay-command="justifyCenter" layedit-event="center"">&#xe647;</i>',right:'<i class="layui-icon layedit-tool-right" title="右对齐" lay-command="justifyRight" layedit-event="right"">&#xe648;</i>',link:'<i class="layui-icon layedit-tool-link" title="插入链接" layedit-event="link"">&#xe64c;</i>',unlink:'<i class="layui-icon layedit-tool-unlink layui-disabled" title="清除链接" lay-command="unlink" layedit-event="unlink"">&#xe64d;</i>',face:'<i class="layui-icon layedit-tool-face" title="表情" layedit-event="face"">&#xe650;</i>',image:'<i class="layui-icon layedit-tool-image" title="图片" layedit-event="image">&#xe64a;<input type="file" name="file"></i>',code:'<i class="layui-icon layedit-tool-code" title="插入代码" layedit-event="code">&#xe64e;</i>',help:'<i class="layui-icon layedit-tool-help" title="帮助" layedit-event="help">&#xe607;</i>'},T=new u;t(o,T)});