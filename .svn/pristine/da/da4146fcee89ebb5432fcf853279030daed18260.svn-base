layui.link("./script/newTask/newTask_taskList.css");layui.define(["layer","element","form","table","config_interactivity","config_constant","laydate","qRouter"],function(e){var a=layui.layer;var t=layui.element;var s=layui.form;var i=layui.table;var l=layui.laydate;var n=layui.qRouter;var o=layui.config_interactivity;var r=layui.config_constant;var u={newTask_taskList:function(e){var o=this;var u=null;var p=null;var c=null;if(JSON.parse($.localStorage.getItem("newTaskLinkTable"))==undefined||JSON.parse($.localStorage.getItem("newTaskLinkTable"))==null||JSON.parse($.localStorage.getItem("newTaskLinkTable"))=="null"){$.localStorage.setItem("newTaskLinkTable",JSON.stringify([]))}var k=null;var d=null;var _={};var v=$("[id^='render-newTask_taskList']");v.empty();$.each(v,function(e,o){var f="";var T=$("#"+o.id);f+='<div class="newTask_taskList_contain">';f+='<form class="layui-form" action="">';f+='<div class="newTask_taskList-buttonGroup">';f+='<div class="layui-btn layui-btn-normal newTaskLink">新增任务环节</div>';f+='<div class="layui-btn layui-btn-normal taskLinkChange">任务环节变更</div>';f+='<div class="layui-btn layui-btn-normal taskDetails">任务详情</div>';f+='<div class="layui-btn layui-btn-normal deleteTaskDetails">删除任务详情</div>';f+="</div>";f+="<div>";f+='<table id="newTask_taskList_table" lay-filter="newTask_taskList_table"></table>';f+="</div>";f+="</form>";f+="</div>";v.empty();v.append(f);t.init();s.render();var L=$("[id^='render-basicInformation']");if(L.length!=0){var m=JSON.parse($.sessionStorage.getItem("tabList_data"));$.localStorage.setItem("AdmintaskLineID",m.id);i.render({elem:"#newTask_taskList_table",method:"post",url:r.URL_HEADER+"/task/a/search",where:{taskId:m.id},page:true,limits:[10,20,30],cols:[[{field:"batch_id",title:"批次",sort:true,event:"vehicleNumber",align:"center"},{field:"task_id",title:"任务号",width:180,sort:true,event:"batch_id"},{field:"mileage",title:"里程",sort:true,event:"vehicleNumber"},{field:"step_value",title:"任务环节",sort:true,event:"vehicleNumber"},{field:"department_value",title:"负责单位",sort:true,event:"vehicleNumber"},{field:"name",title:"组长",sort:true,event:"vehicleNumber"},{field:"status_value",title:"任务状态",sort:true,event:"vehicleNumber"},{field:"type_value",title:"任务类型",sort:true,event:"vehicleNumber"},{field:"accept_number",title:"次数",sort:true,event:"vehicleNumber"},{field:"production_projects",title:"制作项",width:220,sort:true,event:"vehicleNumber"},{field:"launch_date",title:"作业上线日期",sort:true,event:"vehicleNumber"},{field:"finish_date",title:"制作完成日期",sort:true,event:"vehicleNumber"},{field:"pre_manday",title:"预期人天",sort:true,event:"vehicleNumber"},{field:"status_value",title:"操作",sort:true,event:"task_operation",align:"center",templet:function(e){if(e.status==1){return'<div class="layui-btn layui-btn-primary layui-btn-xs task_operation_issuedTask">下发任务</div>'}if(e.status==2||e.status==3||e.status==4||e.status==5||e.status==8||e.status==9||e.status==10){return'<div class="layui-btn layui-btn-primary  layui-btn-xs">无操作</div>'}if(e.status==6||e.status==7){return'<div class="layui-btn layui-btn-primary  layui-btn-xs task_operation_modifyTask">修改任务</div>'}if(e.status==11){return'<div class="layui-btn layui-btn-primary  layui-btn-xs task_operation_qualityInspectionTasks">质检任务</div>'}}}]]})}else{i.render({elem:"#newTask_taskList_table",method:"get",page:true,limits:[10,20,30],cols:[[{field:"batch_id",title:"批次",sort:true,event:"vehicleNumber",align:"center"},{field:"task_id",title:"任务号",width:180,sort:true,event:"batch_id"},{field:"mileage",title:"里程",sort:true,event:"vehicleNumber"},{field:"step_value",title:"任务环节",sort:true,event:"vehicleNumber"},{field:"department_value",title:"负责单位",sort:true,event:"vehicleNumber"},{field:"name",title:"组长",sort:true,event:"vehicleNumber"},{field:"status_value",title:"任务状态",sort:true,event:"vehicleNumber"},{field:"type_value",title:"任务类型",sort:true,event:"vehicleNumber"},{field:"accept_number",title:"次数",sort:true,event:"vehicleNumber"},{field:"production_projects",title:"制作项",width:220,sort:true,event:"vehicleNumber"},{field:"launch_date",title:"作业上线日期",sort:true,event:"vehicleNumber"},{field:"finish_date",title:"制作完成日期",sort:true,event:"vehicleNumber"},{field:"pre_manday",title:"预期人天",sort:true,event:"vehicleNumber"},{field:"status_value",title:"操作",sort:true,event:"task_operation",align:"center",templet:function(e){if(e.status==1){return'<div class="layui-btn layui-btn-primary layui-btn-xs task_operation_issuedTask">下发任务</div>'}if(e.status==2||e.status==3||e.status==4||e.status==5||e.status==8||e.status==9||e.status==10){return'<div class="layui-btn layui-btn-primary  layui-btn-xs">无操作</div>'}if(e.status==6||e.status==7){return'<div class="layui-btn layui-btn-primary  layui-btn-xs task_operation_modifyTask">修改任务</div>'}if(e.status==11){return'<div class="layui-btn layui-btn-primary  layui-btn-xs task_operation_qualityInspectionTasks">质检任务</div>'}}}]],data:JSON.parse($.localStorage.getItem("newTaskLinkTable"))})}var w="newTask_taskList_table";i.on("tool("+w+")",function(e){d=e;var a=e.data;$.sessionStorage.setItem("newTask_taskList_data",JSON.stringify(a));$.localStorage.setItem("taskList_localStorageData",JSON.stringify(a));if(e.event=="task_operation"){var t=e.tr;if(t.find(".task_operation_issuedTask").length!=0){g()}if(t.find(".task_operation_modifyTask").length!=0){y("modifyTask")}if(t.find(".task_operation_qualityInspectionTasks").length!=0){y("qualityInspectionTasks")}}});$(".newTask_taskList_contain .newTaskLink").on("click",function(){if($.localStorage.getItem("missionBasicInformation")==undefined||$.localStorage.getItem("missionBasicInformation")==null){a.alert("请先填写基本信息")}else{var e="";e+='<div class="newTask_taskList-PopupContain">';e+='<form class="layui-form" action="" lay-filter="popue_tablist_form">';e+='<div class="newTask_taskList-PopupGroup newTask_taskList-singleRow">';e+='<label class="newTask_taskList-PopupTitle">任务环节:</label>';e+='<div class="newTask_taskList-PopupInput" id="newTask_taskList_taskLink">';e+='<select name="city" disabled lay-verify="newTask_newProductionItems">';e+='<option value="制作" selected>制作</option>';e+="</select>";e+="</div>";e+="</div>";e+='<div class="newTask_taskList-PopupGroup newTask_taskList-PopupGroupCheckbox newTask_taskList-singleRow">';e+='<label class="newTask_taskList-PopupTitle">制作项:</label>';e+='<div class="newTask_taskList-PopupInput" id="newTask_taskList_makeProject">';$.ajax({type:"get",async:false,url:r.URL_HEADER+"/task/projects/search",success:function(a){$.each(a.data,function(a,t){e+='<div class="newTask_taskList-PopupGroupCheckbox">';e+='<input value="'+t.id+'" type="checkbox" lay-skin="primary" title="'+t.value+'">';e+="</div>"})},error:function(e,a){}});e+="</div>";e+="</div>";e+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';e+='<label class="newTask_taskList-PopupTitle">负责单位:</label>';e+='<div class="newTask_taskList-PopupInput" id="newTask_taskList_chargeUunit">';e+="<select>";e+='<option value="">请选择</option>';$.ajax({type:"get",async:false,url:r.URL_HEADER+"/sys/department/search",success:function(a){p=a.data;$.each(a.data,function(a,t){e+='<option value="'+t.id+'">'+t.value+"</option>"})},error:function(e,a){}});e+="</select>";e+="</div>";e+="</div>";e+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';e+='<label class="newTask_taskList-PopupTitle">组长:</label>';e+='<div class="newTask_taskList-PopupInput">';e+='<input autocomplete="off"  class="layui-input" id="newTask_taskList_PopupePopup" placeholder="请选择组长">';e+="</div>";e+="</div>";e+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';e+='<label class="newTask_taskList-PopupTitle">效率:</label>';e+='<div class="newTask_taskList-PopupInput">';e+='<input onkeydown="if(event.keyCode==32) return false" autocomplete="off"  class="layui-input" id="newTask_taskList_Popupefficiency" placeholder="请输入效率">';e+="</div>";e+="</div>";e+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';e+='<label class="newTask_taskList-PopupTitle">任务量(里程/效率):</label>';e+='<div class="newTask_taskList-PopupInput">';e+='<input autocomplete="off" disabled  class="layui-input" id="newTask_taskList_PopupegetMileage" placeholder="里程/效率">';e+="</div>";e+="</div>";e+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';e+='<label class="newTask_taskList-PopupTitle">上线日期(计划):</label>';e+='<div class="newTask_taskList-PopupInput">';e+='<input  onkeydown="if(event.keyCode==32) return false" type="text"   placeholder="请选择上线日期(计划)" autocomplete="off" id="newTask_taskList_launchDate" class="layui-input">';e+="</div>";e+="</div>";e+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';e+='<label class="newTask_taskList-PopupTitle">完成日期(计划):</label>';e+='<div class="newTask_taskList-PopupInput completionDate">';e+='<input  onkeydown="if(event.keyCode==32) return false" type="text"   placeholder="请选择完成日期(计划)" autocomplete="off" id="newTask_taskList_completionDate" class="layui-input">';e+="</div>";e+="</div>";e+='<div class="newTask_taskList-PopupGroup newTask_taskList-PopupGroupCheckbox newTask_taskList_ssuedTask">';e+='<div class="newTask_taskList-PopupGroupCheckbox newTask_taskList-singleRow" id="newTask_taskList_synchronizeTasks">';e+='<input  type="checkbox" lay-skin="primary" title="执行保存后,同步下发该任务">';e+="</div>";e+="</div>";e+='<div class="newTask_taskList-PopupGroupButton">';e+='<div class="newTask_taskList-buttonSubmit">';e+='<div class="layui-btn layui-btn-normal" id="buttonSubmit-cancel">取消</div>';e+='<div class="layui-btn lay-submit layui-btn-normal" id="buttonSubmit-submit" lay-filter="formDemo">提交</div>';e+="</div>";e+="</div>";e+="</form>";a.open({title:"新增任务环节",type:1,skin:"layui-layer-taskSkin",area:["500px","580px"],content:e,closeBtn:0,shadeClose:true,success:function(e,n){k=n;t.render();s.render(null,"popue_tablist_form");l.render({elem:"#newTask_taskList_launchDate",type:"date",done:function(e,a,t){}});l.render({elem:"#newTask_taskList_completionDate",type:"date",done:function(e,a,t){}});$("#buttonSubmit-cancel").on("click",function(){a.closeAll()});$("#newTask_taskList_PopupePopup").on("focus",function(){var e=1;var t=$("#newTask_taskList_chargeUunit input");if(e=""){a.alert("请选择任务环节")}else if(t.val()==""){a.alert("请选择负责单位")}else{var s="";s+='<div class="selectGroupLeader_container">';s+='<form class="layui-form" action="">';s+='<label class="selectGroupLeader_label">输入框</label>';s+='<div class="layui-input-inline selectGroupLeader_input">';s+='<input type="text" name="title" required  lay-verify="required" placeholder="搜索组长" autocomplete="off" class="layui-input searchValue">';s+="</div>";s+='<div class="layui-btn layui-btn-normal search" style="margin-left:10px;">搜索</div>';s+="</form>";s+='<table id="selectGroupLeader_table" lay-filter="selectGroupLeader_table"></table>';s+='<div class="layui-btn layui-btn-primary selectGroupLeader_moveBtn closeWindow">取消</div>';s+='<div class="layui-btn layui-btn-normal addMsg">添加</div>';s+="</div>";var l="";a.open({title:"添加已有任务号",type:1,skin:"layui-layer-taskSkin",area:["590px","500px"],content:s,closeBtn:0,shadeClose:true,success:function(e,s){var l=1;var n="";$.each(p,function(e,a){if(a.value==t.val()){n=a.id}});i.render({elem:"#selectGroupLeader_table",method:"post",url:r.URL_HEADER+"/sys/user/search/group_leader",where:{stepId:l,departmentId:n},cellMinWidth:100,height:322,page:true,limits:[10,20,30],cols:[[{field:"id",title:"ID",sort:true,align:"center",event:"addTaskId"},{field:"qq",title:"QQ号",sort:true,align:"center",event:"addTaskId"},{field:"name",title:"姓名",sort:true,align:"center",event:"addTaskId"}]]});i.on("tool(selectGroupLeader_table)",function(e){var a=e.data,t=e.event;if(t==="addTaskId"){$.sessionStorage.setItem("newTask_taskList_PopupePopup",JSON.stringify(a))}});$(".search").on("click",function(){var e=$(".searchValue").val();i.reload("selectGroupLeader_table",{url:r.URL_HEADER+"/sys/user/search/group_leader",method:"post",where:{search:e,stepId:l,departmentId:n}})}),$(".closeWindow").on("click",function(){a.close(s);var e=$("#newTask_taskList_PopupePopup");e.val("");$.sessionStorage.setItem("newTask_taskList_PopupePopup",null)});$(".addMsg").on("click",function(){var e=JSON.parse($.sessionStorage.getItem("newTask_taskList_PopupePopup"));if(e!=null&&e!=undefined&&e!="null"){var t=e.name;c=e.id;var i=$("#newTask_taskList_PopupePopup");i.val(t);a.close(s);$.sessionStorage.setItem("newTask_taskList_PopupePopup",null)}else{a.alert("请选中要添加的行")}})}})}});$("#newTask_taskList_Popupefficiency").on("keyup",function(){var e=JSON.parse($.localStorage.getItem("missionBasicInformation")).mileage;var a=parseFloat(e)/parseFloat($("#newTask_taskList_Popupefficiency").val());if($("#newTask_taskList_Popupefficiency").val()==""){$("#newTask_taskList_PopupegetMileage").val("里程/效率")}else if(Number($("#newTask_taskList_Popupefficiency").val())==0){$("#newTask_taskList_PopupegetMileage").val("效率不能为0")}else if(isNaN(Number($("#newTask_taskList_Popupefficiency").val()))){$("#newTask_taskList_PopupegetMileage").val("效率只能为数字")}else{$("#newTask_taskList_PopupegetMileage").val(a.toFixed(5))}});$("#buttonSubmit-submit").on("click",function(){var e=1;var t=[];var s=$("#newTask_taskList_makeProject .newTask_taskList-PopupGroupCheckbox");$.each(s,function(e,a){if($(a).find(".layui-form-checked").length>0){t.push($(a).find("input")[0].title)}});var l=$("#newTask_taskList_chargeUunit input");var n=$("#newTask_taskList_PopupePopup");var o=$("#newTask_taskList_Popupefficiency");var u=$("#newTask_taskList_PopupegetMileage");var d=$("#newTask_taskList_launchDate");var v=$("#newTask_taskList_completionDate");var f="";var T=$("#newTask_taskList_synchronizeTasks");if($(T).find(".layui-form-checked").length>0){f=true}else{f=false}if(e==""){a.alert("请选择任务环节")}else if(t.length==0){a.alert("请选择制作项")}else if(l.val()==""){a.alert("请选择单位")}else if(n.val()==""){a.alert("请选择组长")}else if(o.val()==""){a.alert("效率不能为空")}else if(Number(o.val())==0){a.alert("效率不能为0")}else if(isNaN(Number(o.val()))){a.alert("效率只能为数字")}else if(u.val()==""){a.alert("请检查效率或者里程是否输入正确")}else if(d.val()==""){a.alert("请选择上线日期")}else if(v.val()==""){a.alert("请选择完成日期")}else{_.stepId=1;var L="";if(t.length==0){L=t[0]}else{$.each(t,function(e,a){if(t.length-1==e){L+=a}else{L+=a+"|"}})}_.productionProjects=L;$.each(p,function(e,a){if(a.value==l.val()){_.departmentId=a.id}});_.userId=c;_.preManday=Number(u.val());_.launchDate=d.val();_.finishDate=v.val();_.flag=f;_.taskId=JSON.parse($.localStorage.getItem("missionBasicInformationCallData")).id;_.typeId=JSON.parse($.localStorage.getItem("missionBasicInformationCallData")).typeId;var m=a.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",url:r.URL_HEADER+"/task/a/save",data:JSON.stringify(_),success:function(e){$.sessionStorage.setItem("newTask_taskList_data",null);if(e.code==0){var t=$("[id^='render-basicInformation']");if(t.length!=0){i.reload("newTask_taskList_table",{method:"post",url:r.URL_HEADER+"/task/a/search",where:{taskId:$.localStorage.getItem("AdmintaskLineID")}})}else{var s=JSON.parse($.localStorage.getItem("newTaskLinkTable"));s.push(e.data);$.localStorage.setItem("newTaskLinkTable",JSON.stringify(s));i.reload("newTask_taskList_table",{method:"get",data:JSON.parse($.localStorage.getItem("newTaskLinkTable"))});if(JSON.parse($.localStorage.getItem("newTaskLinkTable")).length==0){$.sessionStorage.setItem("newTask_taskList_data",null)}}a.close(k);a.alert("任务环节添加成功");a.close(m)}else{a.close(m);a.alert("任务环节添加失败")}},error:function(e){a.close(m);a.alert("任务环节添加失败")}})}})}})}});function b(){var e=JSON.parse($.sessionStorage.getItem("newTask_taskList_data"));var n="";n+='<div class="newTask_taskList-PopupContain">';n+='<form class="layui-form" action="" lay-filter="popue_tablist_form">';n+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';n+='<label class="newTask_taskList-PopupTitle">任务环节:</label>';n+='<div class="newTask_taskList-PopupInput" id="newTask_taskList_taskLink">';n+='<select disabled lay-filter="newTask_taskList_taskLink_select">';n+='<option value="" selected></option>';n+="</select>";n+="</div>";n+="</div>";n+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow taskLink_number">';n+='<label class="newTask_taskList-PopupTitle">次数:</label>';n+='<div class="newTask_taskList-PopupInput">';n+='<input onkeydown="if(event.keyCode==32) return false" autocomplete="off"  class="layui-input" id="newTask_taskList_number" placeholder="请输入次数">';n+="</div>";n+="</div>";n+='<div class="newTask_taskList-PopupGroup newTask_taskList-PopupGroupCheckbox newTask_taskList-singleRow">';n+='<label class="newTask_taskList-PopupTitle">制作项:</label>';n+='<div class="newTask_taskList-PopupInput" id="newTask_taskList_makeProject">';$.ajax({type:"get",async:false,url:r.URL_HEADER+"/task/projects/search",success:function(e){$.each(e.data,function(e,a){n+='<div class="newTask_taskList-PopupGroupCheckbox">';n+='<input disabled value="'+a.id+'" type="checkbox" lay-skin="primary" title="'+a.value+'">';n+="</div>"})},error:function(e,a){}});n+="</div>";n+="</div>";n+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';n+='<label class="newTask_taskList-PopupTitle">负责单位:</label>';n+='<div class="newTask_taskList-PopupInput" id="newTask_taskList_chargeUunit">';n+="<select>";n+='<option value="">请选择</option>';$.ajax({type:"get",async:false,url:r.URL_HEADER+"/sys/department/search",success:function(e){p=e.data;$.each(e.data,function(e,a){n+='<option value="'+a.id+'">'+a.value+"</option>"})},error:function(e,a){}});n+="</select>";n+="</div>";n+="</div>";n+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';n+='<label class="newTask_taskList-PopupTitle">组长:</label>';n+='<div class="newTask_taskList-PopupInput">';n+='<input autocomplete="off"  class="layui-input" id="newTask_taskList_PopupePopup" placeholder="请选择组长">';n+="</div>";n+="</div>";n+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';n+='<label class="newTask_taskList-PopupTitle">效率:</label>';n+='<div class="newTask_taskList-PopupInput">';n+='<input onkeydown="if(event.keyCode==32) return false" autocomplete="off"  class="layui-input" id="newTask_taskList_Popupefficiency" placeholder="请输入效率">';n+="</div>";n+="</div>";n+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';n+='<label class="newTask_taskList-PopupTitle">任务量(里程/效率):</label>';n+='<div class="newTask_taskList-PopupInput">';n+='<input autocomplete="off" disabled  class="layui-input" id="newTask_taskList_PopupegetMileage" placeholder="里程/效率">';n+="</div>";n+="</div>";n+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';n+='<label class="newTask_taskList-PopupTitle">上线日期(计划):</label>';n+='<div class="newTask_taskList-PopupInput">';n+='<input  onkeydown="if(event.keyCode==32) return false" type="text"   placeholder="请选择上线日期(计划)" autocomplete="off" id="newTask_taskList_launchDate" class="layui-input">';n+="</div>";n+="</div>";n+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';n+='<label class="newTask_taskList-PopupTitle">完成日期(计划):</label>';n+='<div class="newTask_taskList-PopupInput completionDate">';n+='<input  onkeydown="if(event.keyCode==32) return false" type="text"   placeholder="请选择完成日期(计划)" autocomplete="off" id="newTask_taskList_completionDate" class="layui-input">';n+="</div>";n+="</div>";n+='<div class="newTask_taskList-PopupGroup newTask_taskList-singleRowState">';n+='<label class="newTask_taskList-PopupTitle">任务状态:</label>';n+='<div class="newTask_taskList-PopupInput" id="newTask_taskList_taskState">';n+='<select lay-filter="newTask_taskList_taskState_select">';n+='<option value="">请选择任务状态</option>';n+="</select>";n+="</div>";n+="</div>";n+='<div class="newTask_taskList-PopupGroupButton">';n+='<div class="newTask_taskList-buttonSubmit">';n+='<div class="layui-btn layui-btn-normal" id="buttonSubmit-cancel">取消</div>';n+='<div class="layui-btn lay-submit layui-btn-normal" id="buttonSubmit-submit" lay-filter="formDemo">提交</div>';n+="</div>";n+="</div>";n+="</form>";a.open({title:"修改或质检任务",type:1,skin:"layui-layer-taskSkin",area:["500px","600px"],content:n,closeBtn:0,shadeClose:true,success:function(e,n){k=n;var o=JSON.parse($.sessionStorage.getItem("newTask_taskList_data"));if(o.step_value=="质检"){var d={id:"4,5,6,7,8"};$.ajax({type:"get",async:false,url:r.URL_HEADER+"/task/status/search",data:d,success:function(e){if(e.code=="0"||e.code==0){var a="";a+="<select>";a+='<option value="">请选择</option>';$.each(e.data,function(e,t){a+='<option value="'+t.id+'">'+t.value+"</option>"});a+="</select>";$("#newTask_taskList_taskState").html(a);s.render("select")}},error:function(e,a){}})}if(o.step_value!="质检"){var d={id:"2,3,9,10,11"};$.ajax({type:"get",async:false,url:r.URL_HEADER+"/task/status/search",data:d,success:function(e){if(e.code=="0"||e.code==0){var a="";a+="<select>";a+='<option value="">请选择</option>';$.each(e.data,function(e,t){a+='<option value="'+t.id+'">'+t.value+"</option>"});a+="</select>";$("#newTask_taskList_taskState").html(a);s.render("select")}},error:function(e,a){}})}t.render();s.render(null,"popue_tablist_form");l.render({elem:"#newTask_taskList_launchDate",type:"date",done:function(e,a,t){}});l.render({elem:"#newTask_taskList_completionDate",type:"date",done:function(e,a,t){}});$("#newTask_taskList_taskLink input").val(o.step_value);$("#newTask_taskList_number").val(o.accept_number);var v=[];var f=$("#newTask_taskList_makeProject .newTask_taskList-PopupGroupCheckbox");var T=o.production_projects;var L=T.split("|");$.each(f,function(e,a){if(L.indexOf($(a).find("input")[0].title)>=0){$(a).find("div").addClass("layui-form-checked")}});$("#newTask_taskList_chargeUunit input").val(o.department_value);$("#newTask_taskList_PopupePopup").val(o.name);$("#newTask_taskList_PopupePopup").attr("title",o.user_id);var m=Number(JSON.parse($.localStorage.getItem("missionBasicInformation")).mileage);var w=Number(o.pre_manday);$("#newTask_taskList_Popupefficiency").val((m/w).toFixed(5));$("#newTask_taskList_PopupegetMileage").val(o.pre_manday);$("#newTask_taskList_launchDate").val(o.launch_date);$("#newTask_taskList_completionDate").val(o.finish_date);$("#newTask_taskList_taskState input").val(o.status_value);$("#buttonSubmit-cancel").on("click",function(){a.closeAll()});$("#newTask_taskList_PopupePopup").on("focus",function(){$("#newTask_taskList_PopupePopup").attr("title",null);var e=$("#newTask_taskList_taskLink input");var t=$("#newTask_taskList_chargeUunit input");if(e.val()==""){a.alert("请选择任务环节")}else if(t.val()==""){a.alert("请选择负责单位")}else{var s="";s+='<div class="selectGroupLeader_container">';s+='<form class="layui-form" action="">';s+='<label class="selectGroupLeader_label">输入框</label>';s+='<div class="layui-input-inline selectGroupLeader_input">';s+='<input type="text" name="title" required  lay-verify="required" placeholder="搜索组长" autocomplete="off" class="layui-input searchValue">';s+="</div>";s+='<div class="layui-btn layui-btn-normal search" style="margin-left:10px;">搜索</div>';s+="</form>";s+='<table id="selectGroupLeader_table" lay-filter="selectGroupLeader_table"></table>';s+='<div class="layui-btn layui-btn-primary selectGroupLeader_moveBtn closeWindow">取消</div>';s+='<div class="layui-btn layui-btn-normal addMsg">添加</div>';s+="</div>";var l="";a.open({title:"添加已有任务号",type:1,skin:"layui-layer-taskSkin",area:["590px","500px"],content:s,closeBtn:0,shadeClose:true,success:function(s,l){var n="";$.each(u,function(a,t){if(t.value==e.val()){n=t.id}});var o="";$.each(p,function(e,a){if(a.value==t.val()){o=a.id}});i.render({elem:"#selectGroupLeader_table",method:"post",url:r.URL_HEADER+"/sys/user/search/group_leader",where:{stepId:n,departmentId:o},cellMinWidth:100,height:322,page:true,limits:[10,20,30],cols:[[{field:"id",title:"ID",sort:true,align:"center",event:"addTaskId"},{field:"qq",title:"QQ号",sort:true,align:"center",event:"addTaskId"},{field:"name",title:"姓名",sort:true,align:"center",event:"addTaskId"}]]});i.on("tool(selectGroupLeader_table)",function(e){var a=e.data,t=e.event;if(t==="addTaskId"){$.sessionStorage.setItem("selectGroupLeader_table_data",JSON.stringify(a))}});$(".search").on("click",function(){var e=$(".searchValue").val();i.reload("selectGroupLeader_table",{url:r.URL_HEADER+"/sys/user/search/group_leader",method:"post",where:{search:e,stepId:n,departmentId:o}})}),$(".closeWindow").on("click",function(){a.close(l);var e=$("#newTask_taskList_PopupePopup");e.val("")});$(".addMsg").on("click",function(){var e=JSON.parse($.sessionStorage.getItem("selectGroupLeader_table_data"));var t=e.name;if(e!==null&&e!==undefined){c=e.id;var s=$("#newTask_taskList_PopupePopup");s.val(t);a.close(l)}else{a.alert("请选中要添加的行")}})}})}});$("#newTask_taskList_Popupefficiency").on("keyup",function(){var e=JSON.parse($.localStorage.getItem("missionBasicInformation")).mileage;var a=parseFloat(e)/parseFloat($("#newTask_taskList_Popupefficiency").val());if($("#newTask_taskList_Popupefficiency").val()==""){$("#newTask_taskList_PopupegetMileage").val("里程/效率")}else if(Number($("#newTask_taskList_Popupefficiency").val())==0){$("#newTask_taskList_PopupegetMileage").val("效率不能为0")}else if(isNaN(Number($("#newTask_taskList_Popupefficiency").val()))){$("#newTask_taskList_PopupegetMileage").val("效率只能为数字")}else{$("#newTask_taskList_PopupegetMileage").val(a.toFixed(5))}});$("#buttonSubmit-submit").on("click",function(){var e=$("#newTask_taskList_taskLink input");var t=[];var s=$("#newTask_taskList_makeProject .newTask_taskList-PopupGroupCheckbox");$.each(s,function(e,a){if($(a).find(".layui-form-checked").length>0){t.push($(a).find("input")[0].title)}});var l=$("#newTask_taskList_number");var n=$("#newTask_taskList_chargeUunit input");var o=$("#newTask_taskList_PopupePopup");var d=$("#newTask_taskList_Popupefficiency");var v=$("#newTask_taskList_PopupegetMileage");var f=$("#newTask_taskList_launchDate");var T=$("#newTask_taskList_completionDate");var L=$("#newTask_taskList_taskState input");if(e.val()==""){a.alert("请选择任务环节")}else if(l.val()==""){a.alert("次数不能为空")}else if(isNaN(Number(l.val()))){a.alert("次数只能为数字")}else if(t.length==0){a.alert("请选择制作项")}else if(n.val()==""){a.alert("请选择单位")}else if(o.val()==""){a.alert("请选择组长")}else if(d.val()==""){a.alert("效率不能为空")}else if(Number(d.val())==0){a.alert("效率不能为0")}else if(isNaN(Number(d.val()))){a.alert("效率只能为数字")}else if(v.val()==""){a.alert("请检查效率或者里程是否输入正确")}else if(f.val()==""){a.alert("请选择上线日期")}else if(T.val()==""){a.alert("请选择完成日期")}else if(L.val()==""){a.alert("请选择任务状态")}else{$.each(u,function(a,t){if(t.value==e.val()){_.stepId=t.id}});var m="";if(t.length==0){m=t[0]}else{$.each(t,function(e,a){if(t.length-1==e){m+=a}else{m+=a+"|"}})}_.productionProjects=m;$.each(p,function(e,a){if(a.value==n.val()){_.departmentId=a.id}});if($("#newTask_taskList_PopupePopup").attr("title")==null){_.userId=c}else{_.userId=$("#newTask_taskList_PopupePopup").attr("title")}_.preManday=Number(v.val());_.acceptNumber=Number(l.val());_.launchDate=f.val();_.finishDate=T.val();$.ajax({type:"get",async:false,url:r.URL_HEADER+"/task/status/search",success:function(e){var a=e.data;$.each(a,function(e,a){if(a.value==L.val()){_.status=a.id}})},error:function(e,a){}});_.taskId=JSON.parse($.localStorage.getItem("missionBasicInformationCallData")).id;_.typeId=JSON.parse($.localStorage.getItem("missionBasicInformationCallData")).typeId;var w=JSON.parse($.sessionStorage.getItem("newTask_taskList_data"));_.id=Number(w.id);var b=a.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",url:r.URL_HEADER+"/task/a/update",data:JSON.stringify(_),success:function(e){if(e.code==0){$.sessionStorage.setItem("newTask_taskList_data",null);var t=$("[id^='render-basicInformation']");if(t.length!=0){i.reload("newTask_taskList_table",{method:"post",url:r.URL_HEADER+"/task/a/search",where:{taskId:$.localStorage.getItem("AdmintaskLineID")}})}else{var s=JSON.parse($.localStorage.getItem("newTaskLinkTable"));$.each(s,function(a,t){if(e.data.id==t.id){s.splice(a,1);s.push(e.data);$.localStorage.setItem("newTaskLinkTable",JSON.stringify(s))}});i.reload("newTask_taskList_table",{method:"get",data:JSON.parse($.localStorage.getItem("newTaskLinkTable"))});if(JSON.parse($.localStorage.getItem("newTaskLinkTable")).length==0){$.sessionStorage.setItem("newTask_taskList_data",null)}}a.close(k);a.alert("任务环节更新成功");a.close(b)}else{a.close(b);a.alert("任务环节更新失败")}},error:function(e){a.close(b);a.alert("任务环节更新失败")}})}})}})}function y(e){var n=JSON.parse($.sessionStorage.getItem("newTask_taskList_data"));var o="";o+='<div class="newTask_taskList-PopupContain">';o+='<form class="layui-form" action="" lay-filter="popue_tablist_form">';if(e=="modifyTask"){o+='<div class="newTask_taskList-PopupGroup newTask_taskList-singleRow">';o+='<label class="newTask_taskList-PopupTitle">任务环节:</label>';o+='<div class="newTask_taskList-PopupInput" id="newTask_taskList_taskLink">';o+='<select disabled lay-filter="newTask_taskList_taskLink_select">';o+='<option value="修改" selected>修改</option>';o+="</select>";o+="</div>";o+="</div>"}if(e=="qualityInspectionTasks"){o+='<div class="newTask_taskList-PopupGroup newTask_taskList-singleRow">';o+='<label class="newTask_taskList-PopupTitle">任务环节:</label>';o+='<div class="newTask_taskList-PopupInput" id="newTask_taskList_taskLink">';o+='<select disabled lay-filter="newTask_taskList_taskLink_select">';o+='<option value="质检" selected>质检</option>';o+="</select>";o+="</div>";o+="</div>"}o+='<div class="newTask_taskList-PopupGroup newTask_taskList-PopupGroupCheckbox newTask_taskList-singleRow">';o+='<label class="newTask_taskList-PopupTitle">制作:</label>';o+='<div class="newTask_taskList-PopupInput" id="newTask_taskList_makeProject">';$.ajax({type:"get",async:false,url:r.URL_HEADER+"/task/projects/search",success:function(e){$.each(e.data,function(e,a){o+='<div class="newTask_taskList-PopupGroupCheckbox">';o+='<input disabled value="'+a.id+'" type="checkbox" lay-skin="primary" title="'+a.value+'">';o+="</div>"})},error:function(e,a){}});o+="</div>";o+="</div>";o+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';o+='<label class="newTask_taskList-PopupTitle">负责单位:</label>';o+='<div class="newTask_taskList-PopupInput" id="newTask_taskList_chargeUunit">';o+="<select>";o+='<option value="">请选择</option>';$.ajax({type:"get",async:false,url:r.URL_HEADER+"/sys/department/search",success:function(e){p=e.data;$.each(e.data,function(e,a){o+='<option value="'+a.id+'">'+a.value+"</option>"})},error:function(e,a){}});o+="</select>";o+="</div>";o+="</div>";o+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';o+='<label class="newTask_taskList-PopupTitle">组长:</label>';o+='<div class="newTask_taskList-PopupInput">';o+='<input autocomplete="off"  class="layui-input" id="newTask_taskList_PopupePopup" placeholder="请选择组长">';o+="</div>";o+="</div>";o+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';o+='<label class="newTask_taskList-PopupTitle">效率:</label>';o+='<div class="newTask_taskList-PopupInput">';o+='<input onkeydown="if(event.keyCode==32) return false" autocomplete="off"  class="layui-input" id="newTask_taskList_Popupefficiency" placeholder="请输入效率">';o+="</div>";o+="</div>";o+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';o+='<label class="newTask_taskList-PopupTitle">任务量(里程/效率):</label>';o+='<div class="newTask_taskList-PopupInput">';o+='<input autocomplete="off" disabled  class="layui-input" id="newTask_taskList_PopupegetMileage" placeholder="里程/效率">';o+="</div>";o+="</div>";o+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';o+='<label class="newTask_taskList-PopupTitle">上线日期(计划):</label>';o+='<div class="newTask_taskList-PopupInput">';o+='<input  onkeydown="if(event.keyCode==32) return false" type="text"   placeholder="请选择上线日期(计划)" autocomplete="off" id="newTask_taskList_launchDate" class="layui-input">';o+="</div>";o+="</div>";o+='<div class="newTask_taskList-PopupGroup newTask_taskList-doubleRow">';o+='<label class="newTask_taskList-PopupTitle">完成日期(计划):</label>';o+='<div class="newTask_taskList-PopupInput completionDate">';o+='<input  onkeydown="if(event.keyCode==32) return false" type="text"   placeholder="请选择完成日期(计划)" autocomplete="off" id="newTask_taskList_completionDate" class="layui-input">';o+="</div>";o+="</div>";o+='<div class="newTask_taskList-PopupGroup newTask_taskList-PopupGroupCheckbox newTask_taskList_ssuedTask">';o+='<div class="newTask_taskList-PopupGroupCheckbox newTask_taskList-singleRow" id="newTask_taskList_synchronizeTasks">';o+='<input  type="checkbox" lay-skin="primary" title="执行保存后,同步下发该任务">';o+="</div>";o+="</div>";o+='<div class="newTask_taskList-PopupGroupButton">';o+='<div class="newTask_taskList-buttonSubmit">';o+='<div class="layui-btn layui-btn-normal" id="buttonSubmit-cancel">取消</div>';o+='<div class="layui-btn lay-submit layui-btn-normal" id="buttonSubmit-submit" lay-filter="formDemo">提交</div>';o+="</div>";o+="</div>";o+="</form>";a.open({title:"修改或质检任务",type:1,skin:"layui-layer-taskSkin",area:["500px","600px"],content:o,closeBtn:0,shadeClose:true,success:function(e,n){k=n;var o=JSON.parse($.sessionStorage.getItem("newTask_taskList_data"));t.render();s.render(null,"popue_tablist_form");l.render({elem:"#newTask_taskList_launchDate",type:"date",done:function(e,a,t){}});l.render({elem:"#newTask_taskList_completionDate",type:"date",done:function(e,a,t){}});$("#newTask_taskList_number").val(o.accept_number);var d=[];var v=$("#newTask_taskList_makeProject .newTask_taskList-PopupGroupCheckbox");var f=o.production_projects;var T=f.split("|");$.each(v,function(e,a){if(T.indexOf($(a).find("input")[0].title)>=0){$(a).find("div").addClass("layui-form-checked")}});$("#newTask_taskList_chargeUunit input").val(o.department_value);var L=Number(JSON.parse($.localStorage.getItem("missionBasicInformation")).mileage);var m=Number(o.pre_manday);$("#newTask_taskList_Popupefficiency").val((L/m).toFixed(5));$("#newTask_taskList_PopupegetMileage").val(o.pre_manday);$("#newTask_taskList_launchDate").val(o.launch_date);$("#newTask_taskList_completionDate").val(o.finish_date);$("#buttonSubmit-cancel").on("click",function(){a.closeAll()});$("#newTask_taskList_PopupePopup").on("focus",function(){$("#newTask_taskList_PopupePopup").attr("title",null);var e=$("#newTask_taskList_taskLink input");var t=$("#newTask_taskList_chargeUunit input");if(e.val()==""){a.alert("请选择任务环节")}else if(t.val()==""){a.alert("请选择负责单位")}else{var s="";s+='<div class="selectGroupLeader_container">';s+='<form class="layui-form" action="">';s+='<label class="selectGroupLeader_label">输入框</label>';s+='<div class="layui-input-inline selectGroupLeader_input">';s+='<input type="text" name="title" required  lay-verify="required" placeholder="搜索组长" autocomplete="off" class="layui-input searchValue">';s+="</div>";s+='<div class="layui-btn layui-btn-normal search" style="margin-left:10px;">搜索</div>';s+="</form>";s+='<table id="selectGroupLeader_table" lay-filter="selectGroupLeader_table"></table>';s+='<div class="layui-btn layui-btn-primary selectGroupLeader_moveBtn closeWindow">取消</div>';s+='<div class="layui-btn layui-btn-normal addMsg">添加</div>';s+="</div>";var l="";a.open({title:"添加已有任务号",type:1,skin:"layui-layer-taskSkin",area:["590px","500px"],content:s,closeBtn:0,shadeClose:true,success:function(s,l){var n="";$.ajax({type:"get",async:false,url:r.URL_HEADER+"/task/step/search",success:function(a){u=a.data;$.each(u,function(a,t){if(t.value==e.val()){n=t.id}})},error:function(e,a){}});var o="";$.each(p,function(e,a){if(a.value==t.val()){o=a.id}});i.render({elem:"#selectGroupLeader_table",method:"post",url:r.URL_HEADER+"/sys/user/search/group_leader",where:{stepId:n,departmentId:o},cellMinWidth:100,height:322,page:true,limits:[10,20,30],cols:[[{field:"id",title:"ID",sort:true,align:"center",event:"addTaskId"},{field:"qq",title:"QQ号",sort:true,align:"center",event:"addTaskId"},{field:"name",title:"姓名",sort:true,align:"center",event:"addTaskId"}]]});i.on("tool(selectGroupLeader_table)",function(e){var a=e.data,t=e.event;if(t==="addTaskId"){$.sessionStorage.setItem("selectGroupLeader_table_data",JSON.stringify(a))}});$(".search").on("click",function(){var e=$(".searchValue").val();i.reload("selectGroupLeader_table",{url:r.URL_HEADER+"/sys/user/search/group_leader",method:"post",where:{search:e,stepId:n,departmentId:o}})}),$(".closeWindow").on("click",function(){a.close(l);var e=$("#newTask_taskList_PopupePopup");e.val("")});$(".addMsg").on("click",function(){var e=JSON.parse($.sessionStorage.getItem("selectGroupLeader_table_data"));var t=e.name;if(e!==null&&e!==undefined){c=e.id;var s=$("#newTask_taskList_PopupePopup");s.val(t);a.close(l)}else{a.alert("请选中要添加的行")}})}})}});$("#newTask_taskList_Popupefficiency").on("keyup",function(){var e=JSON.parse($.localStorage.getItem("missionBasicInformation")).mileage;var a=parseFloat(e)/parseFloat($("#newTask_taskList_Popupefficiency").val());if($("#newTask_taskList_Popupefficiency").val()==""){$("#newTask_taskList_PopupegetMileage").val("里程/效率")}else if(Number($("#newTask_taskList_Popupefficiency").val())==0){$("#newTask_taskList_PopupegetMileage").val("效率不能为0")}else if(isNaN(Number($("#newTask_taskList_Popupefficiency").val()))){$("#newTask_taskList_PopupegetMileage").val("效率只能为数字")}else{$("#newTask_taskList_PopupegetMileage").val(a.toFixed(5))}});$("#buttonSubmit-submit").on("click",function(){var e=$("#newTask_taskList_taskLink input");var t=[];var s=$("#newTask_taskList_makeProject .newTask_taskList-PopupGroupCheckbox");$.each(s,function(e,a){if($(a).find(".layui-form-checked").length>0){t.push($(a).find("input")[0].title)}});var l=$("#newTask_taskList_chargeUunit input");var n=$("#newTask_taskList_PopupePopup");var o=$("#newTask_taskList_Popupefficiency");var d=$("#newTask_taskList_PopupegetMileage");var v=$("#newTask_taskList_launchDate");var f=$("#newTask_taskList_completionDate");var T="";var L=$("#newTask_taskList_synchronizeTasks");if($(L).find(".layui-form-checked").length>0){T=true}else{T=false}if(e.val()==""){a.alert("请选择任务环节")}else if(t.length==0){a.alert("请选择制作项")}else if(l.val()==""){a.alert("请选择单位")}else if(n.val()==""){a.alert("请选择组长")}else if(o.val()==""){a.alert("效率不能为空")}else if(Number(o.val())==0){a.alert("效率不能为0")}else if(isNaN(Number(o.val()))){a.alert("效率只能为数字")}else if(d.val()==""){a.alert("请检查效率或者里程是否输入正确")}else if(v.val()==""){a.alert("请选择上线日期")}else if(f.val()==""){a.alert("请选择完成日期")}else{$.each(u,function(a,t){if(t.value==e.val()){_.stepId=t.id}});var m="";if(t.length==0){m=t[0]}else{$.each(t,function(e,a){if(t.length-1==e){m+=a}else{m+=a+"|"}})}_.productionProjects=m;$.each(p,function(e,a){if(a.value==l.val()){_.departmentId=a.id}});if($("#newTask_taskList_PopupePopup").attr("title")==null){_.userId=c}else{_.userId=$("#newTask_taskList_PopupePopup").attr("title")}_.preManday=Number(d.val());_.launchDate=v.val();_.finishDate=f.val();_.flag=T;_.taskId=JSON.parse($.localStorage.getItem("missionBasicInformationCallData")).id;_.typeId=JSON.parse($.localStorage.getItem("missionBasicInformationCallData")).typeId;var w=JSON.parse($.sessionStorage.getItem("newTask_taskList_data"));_.batchId=w.batch_id;var b=a.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",contentType:"application/json",url:r.URL_HEADER+"/task/a/save",data:JSON.stringify(_),success:function(e){$.sessionStorage.setItem("newTask_taskList_data",null);if(e.code==0){var t=$("[id^='render-basicInformation']");if(t.length!=0){i.reload("newTask_taskList_table",{method:"post",url:r.URL_HEADER+"/task/a/search",where:{taskId:$.localStorage.getItem("AdmintaskLineID")}})}else{var s=JSON.parse($.localStorage.getItem("newTaskLinkTable"));s.push(e.data);$.localStorage.setItem("newTaskLinkTable",JSON.stringify(s));i.reload("newTask_taskList_table",{method:"get",data:JSON.parse($.localStorage.getItem("newTaskLinkTable"))});if(JSON.parse($.localStorage.getItem("newTaskLinkTable")).length==0){$.sessionStorage.setItem("newTask_taskList_data",null)}}a.close(k);a.alert("任务环节添加成功");a.close(b)}else{a.close(b);a.alert("任务环节添加失败")}},error:function(e){a.close(b);a.alert("任务环节添加失败")}})}})}})}$(".newTask_taskList_contain .taskLinkChange").on("click",function(){var e=$("table tr").hasClass("layui-table-click");if(e==true){b()}else{a.alert("请选择一行再进行操作")}});$(".newTask_taskList_contain .taskDetails").on("click",function(){var e=JSON.parse($.sessionStorage.getItem("newTask_taskList_data"));var t=$("table tr").hasClass("layui-table-click");if(t==true){var e=JSON.parse($.sessionStorage.getItem("newTask_taskList_data"));var s=e.step_value;if(s=="质检"){n.go("TaskManagementNav/AdministratorTaskManagement/QualityInspectorTaskList")}else{n.go("TaskManagementNav/AdministratorTaskManagement/OtherTaskList")}}else{a.alert("请选择一行,然后进行操作")}});$(".newTask_taskList_contain .deleteTaskDetails").on("click",function(){var e=JSON.parse($.sessionStorage.getItem("newTask_taskList_data"));var t=$("table tr").hasClass("layui-table-click");if(t==true){var s=e.id;a.confirm("确定要删除这条数据吗?",{btn:["删除","取消"]},function(){$.ajax({type:"post",url:r.URL_HEADER+"/task/a/delete"+"/"+s,data:{},success:function(e){if(e.code==0){var t=$("[id^='render-basicInformation']");if(t.length!=0){d.del()}else{var l=[];var n=JSON.parse($.localStorage.getItem("newTaskLinkTable"));$.each(n,function(e,a){if(a.id!=s){l.push(a)}});$.localStorage.setItem("newTaskLinkTable",JSON.stringify(l));i.reload("newTask_taskList_table",{method:"get",data:JSON.parse($.localStorage.getItem("newTaskLinkTable"))})}a.closeAll();a.msg("删除成功",{time:1e3})}else{a.alert("删除失败,请重新添加")}},error:function(e){a.alert("删除失败,请重新添加")}})},function(){a.closeAll()})}else{a.alert("请选择列表进行删除")}});function g(){a.confirm("确定要下发这个任务吗?",{btn:["确定","取消"]},function(){var e=JSON.parse($.localStorage.getItem("taskList_localStorageData"));var t={};if(e.step_id=="1"){t={status:2,id:e.id}}if(e.step_id=="2"){t={status:4,id:e.id}}if(e.step_id=="3"){t={status:9,id:e.id}}var s=a.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",async:false,data:JSON.stringify(t),contentType:"application/json; charset=utf-8",url:r.URL_HEADER+"/task/a/update_status",success:function(t){if(t.code==0){var l=null;$.ajax({type:"get",async:false,url:r.URL_HEADER+"/task/status/search",success:function(e){l=e.data},error:function(e,a){}});$.sessionStorage.setItem("newTask_taskList_data",null);var n=$("[id^='render-basicInformation']");if(n.length!=0){i.reload("newTask_taskList_table",{method:"post",url:r.URL_HEADER+"/task/a/search",where:{taskId:$.localStorage.getItem("AdmintaskLineID")}})}else{var o=JSON.parse($.localStorage.getItem("newTaskLinkTable"));$.each(o,function(a,t){if(e.id==t.id){o.splice(a,1);if(e.step_id=="1"){e.status=2;$.each(l,function(a,t){if(t.id==2){e.status=2;e.status_value=t.value}})}if(e.step_id=="2"){e.status=4;$.each(l,function(a,t){if(t.id==4){e.status=4;e.status_value=t.value}})}if(e.step_id=="3"){e.status=9;$.each(l,function(a,t){if(t.id==9){e.status=9;e.status_value=t.value}})}o.push(e);$.localStorage.setItem("newTaskLinkTable",JSON.stringify(o))}});i.reload("newTask_taskList_table",{method:"get",data:JSON.parse($.localStorage.getItem("newTaskLinkTable"))});if(JSON.parse($.localStorage.getItem("newTaskLinkTable")).length==0){$.sessionStorage.setItem("newTask_taskList_data",null)}}a.close(s);a.alert("下发成功")}else{a.close(s);a.alert("下发失败,请重新下发")}},error:function(e){a.close(s);a.alert("下发失败,请重新下发")}})},function(){a.closeAll()})}})}};e("newTask_taskList",u)});