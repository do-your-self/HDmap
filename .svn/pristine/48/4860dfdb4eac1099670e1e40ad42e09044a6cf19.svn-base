layui.link("./script/button/button.css");layui.define(["layer","element","form","qRouter","addinformation","upload","laydate","tableList","config_interactivity","table","config_constant"],function(t){var a=layui.layer;var e=layui.element;var n=layui.form;var l=layui.qRouter;var u=layui.upload;var o=layui.laydate;var d=layui.table;var r=layui.config_interactivity;var s=layui.config_constant;var c={button:function(t){var d=this;var c=null;var p=$("[id^='render-button']");p.empty();$.each(p,function(t,a){var i="";var n=$("#"+a.id);var l=n.data("componentData");i+='<div class="button-contain">';i+='<div class="button-flow">';if(l.addButton!=undefined&&l.addButton!=null&&l.addButton.length>0){$.each(l.addButton,function(t,a){if(a.type=="PageJump"){i+='<a id="button-PageJump"  href="'+a.href+'" class="layui-btn layui-btn-normal">'+a.buttonName+"</a>"}if(a.type=="AdditionalTasks"){i+='<a id="button_AdditionalTasks" data_href="'+a.href+'" class="layui-btn layui-btn-normal">'+a.buttonName+"</a>"}if(a.type=="ViewTask"){i+='<a id="button_ViewTask" data_href="'+a.href+'" class="layui-btn layui-btn-normal">'+a.buttonName+"</a>"}if(a.type=="Resetting"){i+='<a id="button-Resetting" class="layui-btn layui-btn-normal">'+a.buttonName+"</a>"}if(a.type=="Determine"){i+='<a id="button-Determine" class="layui-btn layui-btn-normal">'+a.buttonName+"</a>"}if(a.type=="Delete"){i+='<a  id="button-Delete" class="layui-btn layui-btn-normal">'+a.buttonName+"</a>"}if(a.type=="UploadFile"){i+='<a id="button-UploadFile" class="layui-btn layui-btn-normal">'+a.buttonName+"</a>"}if(a.type=="AddData"){i+='<a id="button-AddData" class="layui-btn layui-btn-normal">'+a.buttonName+"</a>"}if(a.type=="ModifyData"){i+='<a id="button-ModifyData" class="layui-btn layui-btn-normal">'+a.buttonName+"</a>"}if(a.type=="SearchData"){i+='<div class="layui-input-inline button-SearchData">';i+='<form class="layui-form">';if(a.listConfig!=undefined&&a.listConfig!=null){$.each(a.listConfig,function(t,a){if(a.type=="formSelect"){i+='<div class="layui-input-inline">';i+='<div class="layui-input-inline">请选择</div>';i+='<div class="layui-input-inline button-SearchData" id="button-SearchSelect">';i+='<div class="layui-input-inline">';i+="<select>";i+='<option value="">任务状态</option>';$.ajax({type:"get",async:false,url:a.url,success:function(t){$.each(t.data,function(t,a){i+='<option value="'+a.id+'">'+a.value+"</option>"})},error:function(t,a){}});i+="</select>";i+="</div>";i+="</div>";i+="</div>"}if(a.type=="input"){i+='<div class="layui-input-inline sss">';i+='<div class="layui-input-inline button-SearchData">';i+='<input id="button-SearchInput" placeholder="请输入搜索内容" onkeydown="if(event.keyCode==32) return false" type="text"  autocomplete="off" class="layui-input">';i+="</div>";i+='<div class="layui-input-inline button-SearchData">';i+='<div class="layui-btn layui-btn-normal" id="button-SearchData">搜索</div>';i+="</div>";i+="</div>"}})}i+="</form>";i+="</div>"}})}i+="</div>";i+="</div>";n.append(i);e.init()});$.each(p,function(t,a){var e="";var i=$("#"+a.id);var n=i.data("componentData");if(n.addButton!=undefined&&n.addButton!=null&&n.addButton.length>0){$.each(n.addButton,function(t,a){if(a.type=="PageJump"){}if(a.type=="AdditionalTasks"){$("#button_AdditionalTasks").data("href",a.href)}if(a.type=="ViewTask"){$("#button_ViewTask").data("href",a.href)}if(a.type=="Resetting"){}if(a.type=="Determine"){}if(a.type=="Delete"){$("#button-Delete").data("buttonDelete",a.url)}if(a.type=="UploadFile"){$("#button-UploadFile").data("buttonUploadFile",a.url)}if(a.type=="AddData"){$("#button-AddData").data("buttonAddData",a)}if(a.type=="ModifyData"){$("#button-ModifyData").data("buttonModifyData",a)}if(a.type=="SearchData"){if(a.listConfig!=undefined&&a.listConfig!=null){$.each(a.listConfig,function(t,a){if(a.type=="formSelect"){$("#button-SearchSelect").data("buttonSearchSelectKey",a.submitkey)}if(a.type=="input"){$("#button-SearchInput").data("buttonSearchInputKey",a.submitkey)}})}}})}});var f=$("#button_AdditionalTasks");f.on("click",function(){var t=$("table tr").hasClass("layui-table-click");if(t==false){a.alert("请选择一行,然后进行操作")}else{var e=f.data("href");l.go(e)}});var b=$("#button_ViewTask");b.on("click",function(){var t=$("table tr").hasClass("layui-table-click");if(t==false){a.alert("请选择一行,然后进行操作")}else{var e=b.data("href");l.go(e)}});var v=$("#button-SearchData");v.on("click",function(a){var e=$("#button-SearchSelect");var i=$("#button-SearchInput");var n={};if(e.length!=0){n[e.data("buttonSearchSelectKey")]=$("#button-SearchSelect input").val()}if(i.length!=0){n[i.data("buttonSearchInputKey")]=i.val()}var l=n;var u=null;if(r!=undefined&&r!=null&&r.length>0){$.each(r,function(a,e){if(e.routesName==t){var i=e.interactivity;$.each(i,function(t,a){if(a.controller=="button"){$.each(a.controlled,function(t,a){if(a.name=="tableList"){layui.tableList.changeData(a.index,l,u)}})}})}})}});var y=$("#button-Resetting");y.on("click",function(a){layui.addinformation.addinformation(t)});var m=$("#button-Determine");m.on("click",function(t){var e=[];var n=$("[id^='addinformation-input']");$.each(n,function(t,a){var i={};var n="#"+a.id;var l=$(n).val();var u=$(n).data("submitkey");var o=$(n).data("inputvalue");i[u]=l;i["title"]=o;e.push(i)});var l=$("[id^='addinformation-realTimeInput']");$.each(l,function(t,a){var i={};var n="#"+a.id;var l=$(n).val();var u=$(n).data("submitkey");var o=$(n).data("inputvalue");i[u]=l;i["title"]=o;e.push(i)});var u=$("[id^='addinformation-timeSelect']");$.each(u,function(t,a){var i={};var n="#"+a.id;var l=$(n).data("addinformationelEmTime");var u=$(n).data("submitkey");var o=$(n).data("inputvalue");i[u]=l;i["title"]=o;e.push(i)});var o=$("[id^='addinformation-formSelect']");$.each(o,function(t,a){var i={};var n="#"+a.id;var l=$(n+" "+"input").val();var u=$(n).data("submitkey");var o=$(n).data("inputvalue");i[u]=l;i["title"]=o;e.push(i)});var d=$("[id^='addinformation-citySelect']");$.each(d,function(t,a){var i={};var n="#"+a.id;var l=$(n).data("citypicker").getCode();var u=$(n).data("submitkey");var o=$(n).data("inputvalue");var d=l.split("/");i[u]=d[d.length-1];i["title"]=o;e.push(i)});var r=$("[id^='addinformation-imgUpload']");$.each(r,function(t,a){var i={};var n="#"+a.id;var l=$(n).data("addinformationFile");var u=$(n).data("submitkey");var o=$(n).data("inputvalue");i[u]=l;i["title"]=o;e.push(i)});var p=$("[id^='addinformation-textArea']");$.each(p,function(t,a){var i={};var n="#"+a.id;var l=$(n).val();var u=$(n).data("submitkey");var o=$(n).data("inputvalue");i[u]=l;i["title"]=o;e.push(i)});var f=0;var b="";$.each(e,function(t,a){$.each(a,function(t,e){if(e==""){b+="请输入"+a.title+"<br>"}else{f++}})});if(f==e.length*2){var v={};for(i in e){for(j in e[i]){if(j!="title"){v[j]=e[i][j]}}}v["userId"]=$.localStorage.getItem("id");return v}else{a.alert(b);return null}$.ajax({type:"post",contentType:"application/json",url:s.URL_HEADER+"/task/save",data:JSON.stringify(getAddinformation),success:function(t){c=t.data.id},error:function(t){}})});var h=$("#button-Delete");h.on("click",function(t){var e=$("table tr").hasClass("layui-table-click");var i=JSON.parse($.sessionStorage.getItem("tabList_data"));if(e==false){a.alert("请选择列表进行删除")}else{var n=i.id;a.confirm("确定要删除这条数据吗?",{btn:["删除","取消"]},function(){var t=h.data("buttonDelete");var e=a.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",url:t+"/"+n,data:{},success:function(t){if(t.code==0){$.sessionStorage.setItem("tabList_data",null);a.closeAll();a.msg("删除成功",{time:1e3});layui.tableList.tableList()}else{a.close(e);a.alert(t.message)}},error:function(t){a.close(e);a.alert("删除失败,请重新删除")}})},function(){a.closeAll()})}});var k=$("#button-UploadFile");k.on("click",function(t){var e=k.data("buttonUploadFile");var i="";i+='<div class="button-PopupContain">';i+='<div class="layui-upload">';i+='<button type="button" class="layui-btn layui-btn-normal" id="testList">选择多文件</button>';i+='<div class="layui-upload-list">';i+='<table class="layui-table">';i+="<thead>";i+="<tr><th>文件名</th>";i+="<th>大小</th>";i+="<th>状态</th>";i+="<th>操作</th>";i+="</tr></thead>";i+='<tbody id="demoList"></tbody>';i+="</table>";i+="</div>";i+='<button type="button" class="layui-btn" id="testListAction">开始上传</button>';i+="</div> ";i+="</div>";a.open({title:"上传文件",type:1,skin:"layui-layer-taskSkin",area:["900px","300px"],content:i,closeBtn:0,shadeClose:true,success:function(t,a){var i=$("#demoList");var n=u.render({elem:"#testList",url:e,accept:"file",multiple:true,auto:false,bindAction:"#testListAction",choose:function(t){var a=this.files=t.pushFile();t.preview(function(e,l,u){var o=$(['<tr id="upload-'+e+'">',"<td>"+l.name+"</td>","<td>"+(l.size/1014).toFixed(1)+"kb</td>","<td>等待上传</td>","<td>",'<button class="layui-btn layui-btn-mini demo-reload layui-hide">重传</button>','<button class="layui-btn layui-btn-mini layui-btn-danger demo-delete">删除</button>',"</td>","</tr>"].join(""));o.find(".demo-reload").on("click",function(){t.upload(e,l)});o.find(".demo-delete").on("click",function(){delete a[e];o.remove();n.config.elem.next()[0].value=""});i.append(o)})},done:function(t,a,e){if(t.code==0){var n=i.find("tr#upload-"+a),l=n.children();l.eq(2).html('<span style="color: #5FB878;">上传成功</span>');l.eq(3).html("");return delete this.files[a]}this.error(a,e)},error:function(t,a){var e=i.find("tr#upload-"+t),n=e.children();n.eq(2).html('<span style="color: #FF5722;">上传失败</span>');n.eq(3).find(".demo-reload").removeClass("layui-hide")}})}});$("#buttonSubmit-cancel").on("click",function(){a.closeAll()})});var S=$("#button-ModifyData");S.on("click",function(t){var i=JSON.parse($.sessionStorage.getItem("tabList_data"));var l=$("table tr").hasClass("layui-table-click");if(l==true){var u=S.data("buttonModifyData");var d=u.url;var r="";r+='<div class="button-PopupContain">';r+='<form class="layui-form" action="">';$.each(u.listConfig,function(t,a){if(a.type=="input"){r+='<div class="button-PopupGroup" data-valuetype="'+a.valueType+'" data-inputtype="input" data-buttonsubmitkey="'+a.submitkey+'" data-inputtype="input" data-readdatakey="'+a.readDataKey+'">';r+='<label class="button-PopupTitle">'+a.title+"</label>";r+='<div class="button-PopupInput">';r+='<input  onkeydown="if(event.keyCode==32) return false" autocomplete="off"  class="layui-input" placeholder="'+a.placeholder+'">';r+="</div>";r+="</div>"}if(a.type=="timeSelect"){r+='<div class="button-PopupGroup" data-inputtype="timeSelect" data-buttonsubmitkey="'+a.submitkey+'" data-inputtype="input" data-readdatakey="'+a.readDataKey+'">';r+='<label class="button-PopupTitle">'+a.title+"</label>";r+='<div class="button-PopupInput">';r+='<input  onkeydown="if(event.keyCode==32) return false" type="text"  placeholder="'+a.placeholder+'" autocomplete="off" class="layui-input" id="button-PopupTimeSelect'+t+'">';r+="</div>";r+="</div>"}if(a.type=="formSelect"){r+='<div class="button-PopupGroup" data-inputtype="formSelect" data-buttonsubmitkey="'+a.submitkey+'" data-inputtype="input" data-readdatakey="'+a.readDataKey+'">';r+='<label class="button-PopupTitle">'+a.title+"</label>";r+='<div class="button-PopupInput">';r+="<select>";r+='<option value="">'+a.placeholder+"</option>";$.ajax({type:"get",async:false,url:a.url,success:function(t){$.each(t.data,function(t,a){r+='<option value="'+a.id+'">'+a.value+"</option>"})},error:function(t,a){}});r+="</select>";r+="</div>";r+="</div>"}});r+='<div class="button-PopupButtonGroup">';r+='<div class="button-buttonSubmit">';r+='<div class="layui-btn layui-btn-normal" id="buttonSubmit-cancel">取消</div>';r+='<div class="layui-btn lay-submit layui-btn-normal" id="buttonSubmit-submit">提交</div>';r+="</div>";r+="</div>";r+="</form>";a.open({title:"修改信息",type:1,skin:"layui-layer-taskSkin",area:u.area,content:r,closeBtn:0,shadeClose:true,success:function(t,a){e.render();n.render();var l=$("[id^='button-PopupTimeSelect']");$.each(l,function(t,a){var e="#"+a.id;o.render({elem:e,type:"date"})});var u=$(".button-PopupGroup");$.each(u,function(t,a){var e=$(a)[0].dataset.readdatakey;var e=i[e];if(e==null||e=="null"){$(a).find("input").val("")}else{$(a).find("input").val(e)}})}});$("#buttonSubmit-cancel").on("click",function(){a.closeAll()});$("#buttonSubmit-submit").on("click",function(){var t=$(".button-PopupGroup");var e={};var n=0;$.each(t,function(l,o){var r=o.dataset.buttonsubmitkey;if(o.dataset.inputtype=="input"&&o.dataset.valuetype=="string"){if(l==n){if($(o).find("input").val()==""){a.alert($(o).find("input")[0].placeholder)}else{n++;e[r]=$(o).find("input").val()}}}else if(o.dataset.inputtype=="input"&&o.dataset.valuetype=="number"){if(l==n){if($(o).find("input").val()==""){a.alert($(o).find("label")[0].innerText+"不能为空")}else if(isNaN(Number($(o).find("input").val()))){a.alert($(o).find("label")[0].innerText+"只能为数字")}else{n++;e[r]=$(o).find("input").val()}}}else if(o.dataset.inputtype=="timeSelect"){if(l==n){if($(o).find("input").val()==""){a.alert($(o).find("input")[0].placeholder)}else{n++;e[r]=$(o).find("input").val()}}}else if(o.dataset.inputtype=="formSelect"){if(l==n){if($(o).find("input").val()==""){a.alert($(o).find("input")[0].placeholder)}else{n++;e[r]=$(o).find("input").val()}}}else{}if(t.length==n){if(u.userIdParameter!=undefined){var s=u.userIdParameter;$.each(s,function(t,a){if(a.keyType=="string"){e[a.submitKey]=i[a.sessionStorageParameter]}if(a.keyType=="number"){e[a.submitKey]=Number(i[a.sessionStorageParameter])}})}var c=a.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",url:d,data:JSON.stringify(e),contentType:"application/json",dataType:"json",success:function(t){if(t.code==0){a.closeAll();a.msg("修改成功",{time:1e3});layui.tableList.tableList()}else{a.close(c);a.alert(t.message)}},error:function(t){a.close(c);a.alert("修改失败")}})}})})}else{a.alert("请选择一行进行修改")}});var g=$("#button-AddData");g.on("click",function(t){var i=g.data("buttonAddData");var l=i.url;var u="";u+='<div class="button-PopupContain">';u+='<form class="layui-form" action="">';$.each(i.listConfig,function(t,a){if(a.type=="input"){u+='<div class="button-PopupGroup" data-valuetype="'+a.valueType+'" data-inputtype="input" data-buttonsubmitkey="'+a.submitkey+'">';u+='<label class="button-PopupTitle">'+a.title+"</label>";u+='<div class="button-PopupInput">';u+='<input  onkeydown="if(event.keyCode==32) return false" autocomplete="off"   class="layui-input" placeholder="'+a.placeholder+'">';u+="</div>";u+="</div>"}if(a.type=="timeSelect"){u+='<div class="button-PopupGroup" data-inputtype="timeSelect" data-buttonsubmitkey="'+a.submitkey+'">';u+='<label class="button-PopupTitle">'+a.title+"</label>";u+='<div class="button-PopupInput">';u+='<input  onkeydown="if(event.keyCode==32) return false" type="text"   placeholder="'+a.placeholder+'" autocomplete="off" class="layui-input" id="button-PopupTimeSelect'+t+'">';u+="</div>";u+="</div>"}if(a.type=="formSelect"){u+='<div class="button-PopupGroup" data-inputtype="formSelect" data-buttonsubmitkey="'+a.submitkey+'">';u+='<label class="button-PopupTitle">'+a.title+"</label>";u+='<div class="button-PopupInput">';u+="<select>";u+='<option value="">'+a.placeholder+"</option>";$.ajax({type:"get",async:false,url:a.url,success:function(t){$.each(t.data,function(t,a){u+='<option value="'+a.id+'">'+a.value+"</option>"})},error:function(t,a){}});u+="</select>";u+="</div>";u+="</div>"}});u+='<div class="button-PopupButtonGroup">';u+='<div class="button-buttonSubmit">';u+='<div class="layui-btn layui-btn-normal" id="buttonSubmit-cancel">取消</div>';u+='<div class="layui-btn lay-submit layui-btn-normal" id="buttonSubmit-submit">提交</div>';u+="</div>";u+="</div>";u+="</form>";a.open({title:"新增信息",type:1,skin:"layui-layer-taskSkin",area:i.area,content:u,closeBtn:0,shadeClose:true,success:function(t,a){e.render();n.render();var i=$("[id^='button-PopupTimeSelect']");$.each(i,function(t,a){var e="#"+a.id;o.render({elem:e,type:"date"})})}});$("#buttonSubmit-cancel").on("click",function(){a.closeAll()});$("#buttonSubmit-submit").on("click",function(){var t=$(".button-PopupGroup");var e={};var n=0;$.each(t,function(u,o){var d=o.dataset.buttonsubmitkey;if(o.dataset.inputtype=="input"&&o.dataset.valuetype=="string"){if(u==n){if($(o).find("input").val()==""){a.alert($(o).find("input")[0].placeholder)}else{n++;e[d]=$(o).find("input").val()}}}else if(o.dataset.inputtype=="input"&&o.dataset.valuetype=="number"){if(u==n){if($(o).find("input").val()==""){a.alert($(o).find("label")[0].innerText+"不能为空")}else if(isNaN(Number($(o).find("input").val()))){a.alert($(o).find("label")[0].innerText+"只能为数字")}else{n++;e[d]=$(o).find("input").val()}}}else if(o.dataset.inputtype=="timeSelect"){if(u==n){if($(o).find("input").val()==""){a.alert($(o).find("input")[0].placeholder)}else{n++;e[d]=$(o).find("input").val()}}}else if(o.dataset.inputtype=="formSelect"){if(u==n){if($(o).find("input").val()==""){a.alert($(o).find("input")[0].placeholder)}else{n++;e[d]=$(o).find("input").val()}}}else{}if(t.length==n){if(i.userIdParameter!=undefined){var r=i.userIdParameter;$.each(r,function(t,a){if(a.keyType=="string"){e[a.submitKey]=$.localStorage.getItem(a.localStorageParameter)}if(a.keyType=="number"){e[a.submitKey]=Number($.localStorage.getItem(a.localStorageParameter))}})}var s=a.load(2,{shade:[.1,"#fff"]});$.ajax({type:"post",url:l,data:JSON.stringify(e),contentType:"application/json",dataType:"json",success:function(t){if(t.code==0){a.closeAll();a.msg("添加成功",{time:1e3});layui.tableList.tableList()}else{a.close(s);a.alert(t.message)}},error:function(t){a.close(s);a.alert("添加失败")}})}})})})}};t("button",c)});